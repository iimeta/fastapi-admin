import{u as K,O as Q,_ as Z}from"./index.00445b44.js";/* empty css               *//* empty css              *//* empty css               *//* empty css               *//* empty css               *//* empty css              *//* empty css               *//* empty css               *//* empty css               */import{d as j,e as p,B as i,C as V,aH as o,aG as s,aL as r,aM as u,u as R,D,aJ as w,aI as q,aD as m,aE as $,aZ as F,aK as A,aF as P,bH as W,bI as X,b2 as Y,b1 as x,bQ as ee,bi as le,bT as ae,aU as te,b5 as oe,bU as se,bV as re}from"./arco.73de4031.js";import{f as ue,h as ne}from"./vue.e54f3d1e.js";import{u as ie}from"./loading.0c20cf1b.js";import{q as de,c as ce,d as pe}from"./notice.d28b0208.js";import{q as me}from"./notice_template.625b468c.js";import{q as ve}from"./admin_user.05357b4a.js";import{q as fe}from"./admin_reseller.67d3a674.js";import{V as be}from"./vditor.18dc4ead.js";import"./chart.b5ad42b0.js";/* empty css                */const ye={class:"container"},_e={class:"wrapper"},ge={class:"submit-btn"},Ve={name:"NoticeUpdate"},$e=j({...Ve,setup(he){const{t:v}=K(),{loading:S,setLoading:y}=ie(!1),N=ue(),h=ne(),L=p(),l=p({id:"",title:"",content:"",category:"",scope:p(),users:[],resellers:[],channels:[],is_popup:!1,priority:p(),expires_at:"",scheduled_time:"",remark:"",status:1}),b=p([]),C=new Map;(async()=>{try{const{data:e}=await me({scenes:["notice"]});b.value=e.items;for(let a=0;a<b.value.length;a+=1)C.set(b.value[a].id,b.value[a])}catch{}})();const M=()=>{const e=C.get(l.value.template);e&&(l.value.title=e.title,l.value.content=e.content,l.value.channels=e.channels)},T=p([]);(async()=>{try{const{data:e}=await ve();T.value=e.items}catch{}})();const B=p([]);(async()=>{try{const{data:e}=await fe();B.value=e.items}catch{}})(),(async(e={id:h.query.id})=>{y(!0);try{const{data:a}=await de(e);l.value.id=a.id,l.value.title=a.title,l.value.content=a.content,l.value.category=a.category,l.value.scope=String(a.scope),l.value.users=a.users,l.value.resellers=a.resellers,l.value.channels=a.channels,l.value.is_popup=a.is_popup,l.value.priority=a.priority,l.value.expires_at=a.expires_at,l.value.scheduled_time=a.scheduled_time,l.value.remark=a.remark,l.value.status=a.status}catch{}finally{y(!1)}})();const k=async e=>{var _;if(!await((_=L.value)==null?void 0:_.validate())){y(!0);try{l.value.status=e,h.query.action?await ce(l.value).then(()=>{let n=v("success.operate");e===1?n=v("success.publish"):e===2&&(n=v("success.save")),F.success(n),N.push({name:"NoticeList"})}):await pe(l.value).then(()=>{let n=v("success.update");e===1?n=v("success.publish"):e===2&&(n=v("success.save")),F.success(n),N.push({name:"NoticeList"})})}catch{}finally{y(!1)}}};return(e,a)=>{const _=Q,n=A,E=P,d=W,g=X,c=Y,H=x,f=ee,I=le,O=ae,U=te,z=oe,G=se,J=re;return i(),V("div",ye,[o(E,{class:"container-breadcrumb"},{default:s(()=>[o(n,null,{default:s(()=>[o(_)]),_:1}),o(n,null,{default:s(()=>[r(u(e.$t("notice.menu")),1)]),_:1}),o(n,null,{default:s(()=>[r(u(e.$t(R(h).query.action?"notice.menu.create":"notice.menu.update")),1)]),_:1})]),_:1}),o(J,{loading:R(S),style:{width:"100%"}},{default:s(()=>[o(G,{class:"general-card","body-style":{padding:"0 20px 20px 20px"},bordered:!1},{default:s(()=>[D("div",_e,[o(z,{ref_key:"formRef",ref:L,model:l.value,class:"form","label-col-props":{span:3},"wrapper-col-props":{span:18}},{default:s(()=>[o(c,{label:e.$t("notice.label.template")},{default:s(()=>[o(g,{modelValue:l.value.template,"onUpdate:modelValue":a[0]||(a[0]=t=>l.value.template=t),placeholder:e.$t("notice.placeholder.template"),scrollbar:!1,"allow-search":"",onChange:M},{default:s(()=>[(i(!0),V(w,null,q(b.value,t=>(i(),m(d,{key:t.id,value:t.id,label:t.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),o(c,{field:"title",label:e.$t("notice.label.title"),rules:[{required:!0,message:e.$t("notice.placeholder.title")}]},{default:s(()=>[o(H,{modelValue:l.value.title,"onUpdate:modelValue":a[1]||(a[1]=t=>l.value.title=t),placeholder:e.$t("notice.placeholder.title"),"allow-clear":""},null,8,["modelValue","placeholder"])]),_:1},8,["label","rules"]),o(c,{field:"category",label:e.$t("notice.label.category"),rules:[{required:!0,message:e.$t("notice.placeholder.category")}]},{default:s(()=>[o(g,{modelValue:l.value.category,"onUpdate:modelValue":a[2]||(a[2]=t=>l.value.category=t),placeholder:e.$t("notice.placeholder.category"),scrollbar:!1,"allow-search":""},{default:s(()=>[o(d,{value:"service"},{default:s(()=>[r(u(e.$t("notice.dict.category.service")),1)]),_:1}),o(d,{value:"activity"},{default:s(()=>[r(u(e.$t("notice.dict.category.activity")),1)]),_:1}),o(d,{value:"safety"},{default:s(()=>[r(u(e.$t("notice.dict.category.safety")),1)]),_:1}),o(d,{value:"maint"},{default:s(()=>[r(u(e.$t("notice.dict.category.maint")),1)]),_:1}),o(d,{value:"product"},{default:s(()=>[r(u(e.$t("notice.dict.category.product")),1)]),_:1}),o(d,{value:"fault"},{default:s(()=>[r(u(e.$t("notice.dict.category.fault")),1)]),_:1})]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label","rules"]),o(c,{field:"scope",label:e.$t("notice.label.scope"),rules:[{required:!0,message:e.$t("notice.placeholder.scope")}]},{default:s(()=>[o(I,{size:"large"},{default:s(()=>[o(f,{modelValue:l.value.scope,"onUpdate:modelValue":a[3]||(a[3]=t=>l.value.scope=t),value:"1"},{default:s(()=>[r(u(e.$t("notice.dict.scope.1")),1)]),_:1},8,["modelValue"]),o(f,{modelValue:l.value.scope,"onUpdate:modelValue":a[4]||(a[4]=t=>l.value.scope=t),value:"2"},{default:s(()=>[r(u(e.$t("notice.dict.scope.2")),1)]),_:1},8,["modelValue"]),o(f,{modelValue:l.value.scope,"onUpdate:modelValue":a[5]||(a[5]=t=>l.value.scope=t),value:"3"},{default:s(()=>[r(u(e.$t("notice.dict.scope.3")),1)]),_:1},8,["modelValue"]),o(f,{modelValue:l.value.scope,"onUpdate:modelValue":a[6]||(a[6]=t=>l.value.scope=t),value:"4"},{default:s(()=>[r(u(e.$t("notice.dict.scope.4")),1)]),_:1},8,["modelValue"]),o(f,{modelValue:l.value.scope,"onUpdate:modelValue":a[7]||(a[7]=t=>l.value.scope=t),value:"5"},{default:s(()=>[r(u(e.$t("notice.dict.scope.5")),1)]),_:1},8,["modelValue"]),o(f,{modelValue:l.value.scope,"onUpdate:modelValue":a[8]||(a[8]=t=>l.value.scope=t),value:"6"},{default:s(()=>[r(u(e.$t("notice.dict.scope.6")),1)]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["label","rules"]),l.value.scope==="4"||l.value.scope==="6"?(i(),m(c,{key:0,field:"users",label:e.$t("common.user"),rules:[{required:!0,message:e.$t("notice.placeholder.users")}]},{default:s(()=>[o(g,{modelValue:l.value.users,"onUpdate:modelValue":a[9]||(a[9]=t=>l.value.users=t),placeholder:e.$t("notice.placeholder.users"),scrollbar:!1,multiple:"","allow-search":"","allow-clear":""},{default:s(()=>[(i(!0),V(w,null,q(T.value,t=>(i(),m(d,{key:t.user_id,value:t.user_id,label:t.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label","rules"])):$("",!0),l.value.scope==="5"||l.value.scope==="6"?(i(),m(c,{key:1,field:"resellers",label:e.$t("common.reseller"),rules:[{required:!0,message:e.$t("notice.placeholder.resellers")}]},{default:s(()=>[o(g,{modelValue:l.value.resellers,"onUpdate:modelValue":a[10]||(a[10]=t=>l.value.resellers=t),placeholder:e.$t("notice.placeholder.resellers"),scrollbar:!1,multiple:"","allow-search":"","allow-clear":""},{default:s(()=>[(i(!0),V(w,null,q(B.value,t=>(i(),m(d,{key:t.user_id,value:t.user_id,label:t.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label","rules"])):$("",!0),o(c,{field:"content",label:e.$t("notice.label.content"),rules:[{required:!0,message:e.$t("notice.placeholder.content")}]},{default:s(()=>[o(be,{modelValue:l.value.content,"onUpdate:modelValue":a[11]||(a[11]=t=>l.value.content=t),style:{flex:"1"}},null,8,["modelValue"])]),_:1},8,["label","rules"]),o(c,{field:"remark",label:e.$t("common.remark")},{default:s(()=>[o(O,{modelValue:l.value.remark,"onUpdate:modelValue":a[12]||(a[12]=t=>l.value.remark=t),placeholder:e.$t("placeholder.remark")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(I,null,{default:s(()=>[D("div",ge,[o(U,{type:"secondary",onClick:a[13]||(a[13]=t=>k(2))},{default:s(()=>[r(u(e.$t("button.draft")),1)]),_:1}),l.value.scheduled_time?$("",!0):(i(),m(U,{key:0,type:"primary",onClick:a[14]||(a[14]=t=>k(1))},{default:s(()=>[r(u(e.$t("button.publish")),1)]),_:1})),l.value.scheduled_time?(i(),m(U,{key:1,type:"primary",onClick:a[15]||(a[15]=t=>k(3))},{default:s(()=>[r(u(e.$t("button.scheduled")),1)]),_:1})):$("",!0)])]),_:1})]),_:1},8,["model"])])]),_:1})]),_:1},8,["loading"])])}}});const je=Z($e,[["__scopeId","data-v-751bb361"]]);export{je as default};
