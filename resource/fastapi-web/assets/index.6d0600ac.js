import{c as R,a as L,b as le,F as ne,_ as q,u as T,g as re,n as ce}from"./index.9e0280d5.js";/* empty css               *//* empty css              */import{d as U,e as $,B as k,aD as B,aG as a,aH as e,C as D,aE as de,u as V,aL as h,aM as p,bm as ue,c2 as ie,bE as _e,bi as O,bT as pe,r as A,c as F,t as me,aZ as N,b1 as W,b2 as M,aU as Z,b5 as K,D as C,aJ as H,bZ as J,b7 as j,c3 as x,b3 as Q,a_ as X,c4 as fe,c5 as ve,aK as be,aF as he,bG as we,bK as ge,bb as $e,b6 as ye}from"./arco.3f46b4ae.js";/* empty css              *//* empty css               *//* empty css                *//* empty css               *//* empty css               *//* empty css                *//* empty css               *//* empty css              *//* empty css               *//* empty css               *//* empty css              */import"./chart.2cea905d.js";import"./vue.dbcf9bc3.js";function Pe(v){return R.post("/api/v1/user/update/info",v)}function Ve(v){return R.post("/api/v1/user/change/password",v)}function ke(v){return R.post("/api/v1/user/change/email",v)}function Ie(v,t){return R.post("/api/v1/user/change/avatar",v,t)}const Ce=["src"],Ue={name:"UserPanel"},Se=U({...Ue,setup(v){const t=L(),m=le(),c={uid:"-2",name:"avatar.png",url:t.avatar||m.getAvatar},r=[{label:"common.user_id",value:t.user_id},{label:"user.center.label.account",value:t.account},{label:"user.center.label.name",value:t.name},{label:"user.center.label.email",value:t.email},{label:"user.center.label.created_at",value:t.created_at}],n=$([c]),d=(_,u)=>{n.value=[u]},b=_=>{const u=new AbortController;return async function(){const{onProgress:o,onError:y,onSuccess:w,fileItem:P,name:g="file"}=_;o(20);const f=new FormData;f.append(g,P.file);const I=l=>{let i;l.total>0&&(i=l.loaded/l.total*100),o(parseInt(String(i),10),l)};try{const l=await Ie(f,{controller:u,onUploadProgress:I});w(l),t.info()}catch(l){y(l)}}(),{abort(){u.abort()}}};return(_,u)=>{const s=ne,o=ue,y=ie,w=_e,P=O,g=pe;return k(),B(g,{bordered:!1},{default:a(()=>[e(P,{size:54},{default:a(()=>[e(y,{"custom-request":b,"list-type":"picture-card","file-list":n.value,"show-upload-button":!0,"show-file-list":!1,onChange:d},{"upload-button":a(()=>[e(o,{size:100,class:"info-avatar"},{"trigger-icon":a(()=>[e(s)]),default:a(()=>[n.value.length?(k(),D("img",{key:0,src:n.value[0].url,style:{"background-color":"#ffffff"}},null,8,Ce)):de("",!0)]),_:1})]),_:1},8,["file-list"]),e(w,{data:V(r),column:2,align:"right",layout:"inline-horizontal","label-style":{width:"140px",fontWeight:"normal",color:"rgb(var(--gray-8))",whiteSpace:"pre"},"value-style":{width:"200px",paddingLeft:"8px",textAlign:"left"}},{label:a(({label:f})=>[h(p(_.$t(f))+" :",1)]),value:a(({value:f})=>[h(p(f),1)]),_:1},8,["data","label-style"])]),_:1})]),_:1})}}});const Be=q(Se,[["__scopeId","data-v-5cddd2e0"]]),qe={name:"BasicInformation"},Fe=U({...qe,setup(v){const{t}=T(),m=$(),c=L(),r=$(!1),n=A({form:{name:c.name},rules:F(()=>({name:[{required:!0,message:t("user.center.form.placeholder.name")}]}))}),{form:d,rules:b}=me(n),_=()=>{r.value||m.value.validate(s=>{s||(r.value=!0,Pe({name:d.value.name}).then(()=>{c.info(),N.success(t("success.save"))}).finally(()=>{r.value=!1}))})},u=()=>{m.value.resetFields()};return(s,o)=>{const y=W,w=M,P=Z,g=O,f=K;return k(),B(f,{ref_key:"formRef",ref:m,model:V(d),rules:V(b),"label-col-props":{span:8},"wrapper-col-props":{span:16},size:"large",class:"form"},{default:a(()=>[e(w,{label:s.$t("user.center.label.name"),field:"name"},{default:a(()=>[e(y,{modelValue:V(d).name,"onUpdate:modelValue":o[0]||(o[0]=I=>V(d).name=I),placeholder:s.$t("user.center.form.placeholder.name"),"max-length":30},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(w,null,{default:a(()=>[e(g,null,{default:a(()=>[e(P,{loading:r.value,type:"primary",onClick:_},{default:a(()=>[h(p(s.$t("button.save")),1)]),_:1},8,["loading"]),e(P,{onClick:u},{default:a(()=>[h(p(s.$t("button.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])}}});const Re=q(Fe,[["__scopeId","data-v-1f6f94b6"]]);const Le={class:"tip"},De={class:"content"},Ee={class:"operation"},ze={name:"UpdatePwd"},Te=U({...ze,setup(v){const{t}=T(),m=L(),c=$(),r=$(!1),n=A({oldPassword:"",newPassword:"",rePassword:""}),d=F(()=>({oldPassword:[{required:!0,message:t("user.center.form.placeholder.current_password")}],newPassword:[{required:!0,message:t("user.center.form.error.required.new_password")},{match:/^(?=.*\d)(?=.*[a-z]).{6,32}$/,message:t("user.center.form.placeholder.new_password")},{validator:(s,o)=>{s===n.oldPassword?o(t("user.center.form.error.validator.new_password")):o()}}],rePassword:[{required:!0,message:t("user.center.form.placeholder.re_password")},{validator:(s,o)=>{s!==n.newPassword?o(t("user.center.form.error.validator.re_password")):o()}}]})),b=()=>{r.value=!1,c.value.resetFields()},_=()=>{c.value.validate(s=>{s||Ve({old_password:n.oldPassword,new_password:n.newPassword}).then(()=>{m.info(),b(),N.success(t("success.update"))})})},u=()=>{r.value=!0};return(s,o)=>{const y=J,w=j,P=x,g=Q,f=M,I=K,l=X;return k(),D(H,null,[e(P,null,{avatar:a(()=>[e(y,null,{default:a(()=>[h(p(s.$t("user.center.label.password")),1)]),_:1})]),description:a(()=>[C("div",Le,p(s.$t("user.center.tip.password")),1),C("div",De,[e(y,null,{default:a(()=>[h(p(s.$t("user.center.content.has_been_set")),1)]),_:1})]),C("div",Ee,[e(w,{title:s.$t("button.update"),onClick:u},{default:a(()=>[h(p(s.$t("button.update")),1)]),_:1},8,["title"])])]),_:1}),e(l,{title:s.$t("user.center.title.update_pwd"),visible:r.value,"mask-closable":!1,"esc-to-close":!1,onOk:_,onCancel:b},{default:a(()=>[e(I,{ref_key:"formRef",ref:c,model:n,rules:V(d),size:"large"},{default:a(()=>[e(f,{label:s.$t("user.center.label.password"),field:"oldPassword"},{default:a(()=>[e(g,{modelValue:n.oldPassword,"onUpdate:modelValue":o[0]||(o[0]=i=>n.oldPassword=i),placeholder:s.$t("user.center.form.placeholder.current_password"),"max-length":32,"allow-clear":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(f,{label:s.$t("user.center.form.label.new_password"),field:"newPassword"},{default:a(()=>[e(g,{modelValue:n.newPassword,"onUpdate:modelValue":o[1]||(o[1]=i=>n.newPassword=i),placeholder:s.$t("user.center.form.placeholder.new_password"),"max-length":32,"allow-clear":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(f,{label:s.$t("user.center.form.label.re_password"),field:"rePassword"},{default:a(()=>[e(g,{modelValue:n.rePassword,"onUpdate:modelValue":o[2]||(o[2]=i=>n.rePassword=i),placeholder:s.$t("user.center.form.placeholder.re_password"),"max-length":32,"allow-clear":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["title","visible"])],64)}}}),Ae={class:"tip"},Ne={class:"content"},Me={class:"operation"},Ke={name:"UpdateEmail"},Ge=U({...Ke,setup(v){const{t}=T(),m=L(),c=$(),r=$(60),n=$(),d=$(!1),b=$(!1),_=$(!1),u=$("user.center.captcha.get"),s=F(()=>t(u.value)),o=A({email:"",code:"",password:""}),y=F(()=>({email:[{required:!0,message:t("user.center.form.placeholder.email")}],code:[{required:!0,message:t("user.center.form.placeholder.captcha")}],password:[{required:!0,message:t("user.center.form.placeholder.current_password")}]})),w=()=>{window.clearInterval(n.value),r.value=60,u.value="user.center.captcha.get",b.value=!1},P=()=>{d.value||c.value.validateField("email",l=>{l||(d.value=!0,u.value="user.center.captcha.ing",re({email:o.email,action:"change_email",channel:m.role,domain:window.location.hostname,path:window.location.pathname}).then(i=>{d.value=!1,b.value=!0,u.value=`${t("user.center.captcha.get")}(${r.value-=1}s)`,n.value=window.setInterval(()=>{r.value-=1,u.value=`${t("user.center.captcha.get")}(${r.value}s)`,r.value<=0&&w()},1e3)}).catch(()=>{w(),d.value=!1}))})},g=()=>{_.value=!1,c.value.resetFields(),w()},f=()=>{c.value.validate(l=>{l||ke({email:o.email,code:o.code,password:o.password}).then(()=>{g(),m.info(),N.success(t("success.save"))})})},I=()=>{_.value=!0};return(l,i)=>{const E=J,Y=j,ee=x,G=W,z=M,ae=Z,te=Q,oe=K,se=X;return k(),D(H,null,[e(ee,null,{avatar:a(()=>[e(E,null,{default:a(()=>[h(p(l.$t("user.center.label.security_email")),1)]),_:1})]),description:a(()=>[C("div",Ae,p(l.$t("user.center.tip.security_email")),1),C("div",Ne,[V(m).email?(k(),B(E,{key:0},{default:a(()=>[h(p(V(m).email),1)]),_:1})):(k(),B(E,{key:1,class:"tip"},{default:a(()=>[h(p(l.$t("user.center.content.security_email")),1)]),_:1}))]),C("div",Me,[e(Y,{title:l.$t("button.update"),onClick:I},{default:a(()=>[h(p(l.$t("button.update")),1)]),_:1},8,["title"])])]),_:1}),e(se,{title:l.$t("user.center.title.update_email"),visible:_.value,"mask-closable":!1,"esc-to-close":!1,onOk:f,onCancel:g},{default:a(()=>[e(oe,{ref_key:"formRef",ref:c,model:o,rules:V(y),size:"large"},{default:a(()=>[e(z,{label:l.$t("user.center.form.label.email"),field:"email"},{default:a(()=>[e(G,{modelValue:o.email,"onUpdate:modelValue":i[0]||(i[0]=S=>o.email=S),placeholder:l.$t("user.center.form.placeholder.email"),"allow-clear":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(z,{label:l.$t("user.center.form.label.captcha"),field:"code"},{default:a(()=>[e(G,{modelValue:o.code,"onUpdate:modelValue":i[1]||(i[1]=S=>o.code=S),placeholder:l.$t("user.center.form.placeholder.captcha"),"max-length":6,"allow-clear":"",style:{width:"80%"}},null,8,["modelValue","placeholder"]),e(ae,{loading:d.value,type:"primary",disabled:b.value,class:"captcha-btn",onClick:P},{default:a(()=>[h(p(V(s)),1)]),_:1},8,["loading","disabled"])]),_:1},8,["label"]),e(z,{label:l.$t("user.center.label.password"),field:"password"},{default:a(()=>[e(te,{modelValue:o.password,"onUpdate:modelValue":i[2]||(i[2]=S=>o.password=S),placeholder:l.$t("user.center.form.placeholder.current_password"),"max-length":32,"allow-clear":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["title","visible"])],64)}}});const Oe=q(Ge,[["__scopeId","data-v-d23c7bae"]]),We={name:"SecuritySettings"},Ze=U({...We,setup(v){return(t,m)=>{const c=fe,r=ve;return k(),B(r,{bordered:!1},{default:a(()=>[e(c,null,{default:a(()=>[e(Te)]),_:1}),e(c,null,{default:a(()=>[e(Oe)]),_:1})]),_:1})}}});const He=q(Ze,[["__scopeId","data-v-5d87507e"]]),Je={class:"container"},je={name:"Setting"},xe=U({...je,setup(v){return(t,m)=>{const c=ce,r=be,n=he,d=we,b=ge,_=$e,u=ye;return k(),D("div",Je,[e(n,{class:"container-breadcrumb"},{default:a(()=>[e(r,null,{default:a(()=>[e(c)]),_:1}),e(r,null,{default:a(()=>[h(p(t.$t("user.center.menu")),1)]),_:1})]),_:1}),e(b,{style:{"margin-bottom":"10px"}},{default:a(()=>[e(d,{span:24},{default:a(()=>[e(Be)]),_:1})]),_:1}),e(b,{class:"wrapper"},{default:a(()=>[e(d,{span:24},{default:a(()=>[e(u,{"default-active-key":"1",type:"rounded"},{default:a(()=>[e(_,{key:"1",title:t.$t("user.center.tab.basic_info")},{default:a(()=>[e(Re)]),_:1},8,["title"]),e(_,{key:"2",title:t.$t("user.center.tab.security_settings")},{default:a(()=>[e(He)]),_:1},8,["title"])]),_:1})]),_:1})]),_:1})])}}});const ma=q(xe,[["__scopeId","data-v-dea977e6"]]);export{ma as default};
