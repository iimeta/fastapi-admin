import{u as re,G as Ae,s as Pe,A as Re,k as Te,B as He,_ as qe}from"./index.9568ffd6.js";/* empty css              *//* empty css               *//* empty css              *//* empty css               *//* empty css               *//* empty css               *//* empty css               *//* empty css               *//* empty css               *//* empty css               *//* empty css               *//* empty css              *//* empty css               *//* empty css              */import{d as ce,e as r,B as s,C as g,aH as e,aG as t,u as V,aD as $,aM as u,aL as w,bA as Oe,bB as je,bC as Me,bE as Ge,bY as Je,bN as de,r as le,c as ne,w as Qe,bF as Ke,bu as H,D as k,aJ as oe,aI as se,E as We,n as Ye,aZ as ie,aK as Ze,aF as Xe,aS as et,b2 as tt,bG as at,bJ as lt,bK as nt,b5 as ot,bL as st,ab as it,aU as rt,bi as ct,bj as dt,bk as ut,bl as mt,b4 as _t,bM as pt,aV as ft,a_ as bt,bT as vt}from"./arco.3f46b4ae.js";import{u as ue}from"./loading.37fd256d.js";import{c as q,S as gt}from"./sortable.esm.078712c4.js";import{q as ht,a as yt,s as kt}from"./finance.136a909a.js";import{Q as O}from"./quota.42a28822.js";/* empty css                *//* empty css                */import"./chart.2cea905d.js";import"./vue.dbcf9bc3.js";import"./common.cfd92899.js";const wt={style:{margin:"10px 0 30px 10px"}},xt={key:1},$t={key:1},Ct={key:1},St={key:1},Vt={name:"BillDetail"},Dt=ce({...Vt,props:{id:{type:String,default:""}},setup(j){const E=j;re();const{loading:b,setLoading:o}=ue(!0),h=r({});return(async(m={id:E.id})=>{o(!0);try{const{data:_}=await ht(m);h.value=_}catch{}finally{o(!1)}})(),(m,_)=>{const p=Oe,v=je,y=Me,D=Ge,x=Je,U=de;return s(),g("div",wt,[e(D,{column:2,bordered:"","value-style":{width:"350px",padding:"5px 8px 5px 20px"}},{default:t(()=>[e(y,{label:m.$t("finance.label.bill.stat_date")},{default:t(()=>[V(b)?(s(),$(v,{key:0,animation:!0},{default:t(()=>[e(p,{rows:1})]),_:1})):(s(),g("span",xt,u(h.value.stat_date||"-"),1))]),_:1},8,["label"]),e(y,{label:m.$t("common.user_id")},{default:t(()=>[V(b)?(s(),$(v,{key:0,animation:!0},{default:t(()=>[e(p,{rows:1})]),_:1})):(s(),g("span",$t,u(h.value.user_id||"-"),1))]),_:1},8,["label"]),e(y,{label:m.$t("common.call")},{default:t(()=>[V(b)?(s(),$(v,{key:0,animation:!0},{default:t(()=>[e(p,{rows:1})]),_:1})):(s(),g("span",Ct,u(h.value.total.toLocaleString()),1))]),_:1},8,["label"]),e(y,{label:m.$t("common.spend")},{default:t(()=>[V(b)?(s(),$(v,{key:0,animation:!0},{default:t(()=>[e(p,{rows:1})]),_:1})):(s(),g("span",St,[e(O,{"model-value":h.value.tokens},null,8,["model-value"])]))]),_:1},8,["label"])]),_:1}),e(U,{style:{"margin-top":"15px"},data:h.value.model_stats,pagination:!1,bordered:!1},{columns:t(()=>[e(x,{title:m.$t("common.model"),"data-index":"model",align:"center"},{cell:t(({record:f})=>[w(u(f.model||"-"),1)]),_:1},8,["title"]),e(x,{title:m.$t("common.call"),"data-index":"total",align:"center"},{cell:t(({record:f})=>[w(u(f.total.toLocaleString()),1)]),_:1},8,["title"]),e(x,{title:m.$t("common.spend"),"data-index":"tokens",align:"center"},{cell:t(({record:f})=>[e(O,{"model-value":f.tokens},null,8,["model-value"])]),_:1},8,["title"])]),_:1},8,["data"])])}}}),It={class:"container"},Bt={class:"action-icon"},zt={class:"action-icon"},Lt={id:"tableSetting"},Et={style:{"margin-right":"4px",cursor:"move"}},Ut={class:"title"},Nt={name:"BillList"},Ft=ce({...Nt,setup(j){const{loading:E,setLoading:b}=ue(!0),{t:o}=re(),h=le({type:"checkbox",showCheckedAll:!0,onlyCurrent:!1}),M=()=>({user_id:r(),stat_date:[]}),m=r([]),_=r(M()),p=r([]),v=r([]),y=r("medium"),D=r(),x=r([]),U=r(!0),f={current:1,pageSize:20,showTotal:!0,showPageSize:!0,pageSizeOptions:[20,50,100,500,1e3]},B=le({...f}),me=ne(()=>[{name:o("size.mini"),value:"mini"},{name:o("size.small"),value:"small"},{name:o("size.medium"),value:"medium"},{name:o("size.large"),value:"large"}]),_e=ne(()=>[{title:o("common.user_id"),dataIndex:"user_id",slotName:"user_id",align:"center",width:80},{title:o("common.call"),dataIndex:"total",slotName:"total",align:"center"},{title:o("finance.columns.models"),dataIndex:"models",slotName:"models",align:"center"},{title:o("common.spend"),dataIndex:"tokens",slotName:"tokens",align:"center"},{title:o("finance.label.bill.stat_date"),dataIndex:"stat_date",slotName:"stat_date",align:"center"},{title:o("common.operations"),dataIndex:"operations",slotName:"operations",align:"center",width:75}]),z=async(a={...f})=>{b(!0);try{const{data:l}=await yt(a);m.value=l.items,B.current=a.current,B.pageSize=a.pageSize,B.total=l.paging.total}catch{}finally{b(!1),D.value.selectAll(!1)}};z();const G=()=>{z({...f,..._.value})},pe=a=>{z({...f,..._.value,current:a})},fe=a=>{f.pageSize=a,z({...f,..._.value})},be=(a,l)=>{y.value=a},ve=(a,l,c)=>{a?p.value.splice(c,0,l):p.value=v.value.filter(d=>d.dataIndex!==l.dataIndex)},J=(a,l,c,d=!1)=>{const i=d?q(a):a;return l>-1&&c>-1&&i.splice(l,1,i.splice(c,1,i[l]).pop()),i},ge=a=>{a&&Ye(()=>{const l=document.getElementById("tableSetting");new gt(l,{onEnd(c){const{oldIndex:d,newIndex:i}=c;J(p.value,d,i),J(v.value,d,i)}})})};Qe(()=>_e.value,a=>{p.value=q(a),p.value.forEach((l,c)=>{l.checked=!0}),v.value=q(p.value)},{deep:!0,immediate:!0});const he=a=>{x.value=a,U.value=!a.length},Q=r(),I=r(!1),C=r({}),ye=async a=>{var c;if(await((c=Q.value)==null?void 0:c.validate())){I.value=!0,a(!1);return}a(),K(C.value)},ke=()=>{I.value=!1},K=a=>{if(x.value.length===0&&!a.stat_date){I.value=!0;return}b(!0),a.ids=x.value,kt(a).then(l=>{b(!1),ie.success(o("success.export")),D.value.selectAll(!1);const c=new Blob([l.data],{type:"application/vnd.ms-excel"}),d=window.URL.createObjectURL(c),i=document.createElement("a");i.href=d,i.setAttribute("download",`${o("finance.menu.bill")}.xlsx`),document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(d)}).catch(l=>{ie.error(o("error.export"),l)})},N=r(!1),W=r(),we=a=>{N.value=!0,W.value=a},xe=()=>{N.value=!1};return(a,l)=>{const c=Ae,d=Ze,i=Xe,Y=et,L=tt,S=at,Z=lt,F=nt,X=ot,ee=st,$e=it,A=rt,te=ct,Ce=Pe,P=dt,Se=Re,Ve=ut,De=mt,Ie=Te,Be=He,ze=_t,Le=pt,Ee=de,Ue=ft,Ne=bt,Fe=vt,R=Ke("permission");return s(),g("div",It,[e(i,{class:"container-breadcrumb"},{default:t(()=>[e(d,null,{default:t(()=>[e(c)]),_:1}),e(d,null,{default:t(()=>[w(u(a.$t("finance.menu")),1)]),_:1}),e(d,null,{default:t(()=>[w(u(a.$t("finance.menu.bill")),1)]),_:1})]),_:1}),e(Fe,{class:"general-card",bordered:!1,"header-style":{padding:"20px"},"body-style":{padding:"25px 20px 20px 20px"}},{default:t(()=>[H((s(),$(F,null,{default:t(()=>[e(S,{flex:1},{default:t(()=>[e(X,{model:_.value,"label-col-props":{span:5},"wrapper-col-props":{span:18},"label-align":"left"},{default:t(()=>[e(F,{gutter:16},{default:t(()=>[e(S,{span:8},{default:t(()=>[e(L,{field:"name",label:a.$t("common.user_id")},{default:t(()=>[e(Y,{modelValue:_.value.user_id,"onUpdate:modelValue":l[0]||(l[0]=n=>_.value.user_id=n),placeholder:a.$t("placeholder.user_id"),precision:0,min:1,"allow-clear":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),e(S,{span:8},{default:t(()=>[e(L,{field:"stat_date",label:a.$t("finance.label.bill.stat_date")},{default:t(()=>[e(Z,{modelValue:_.value.stat_date,"onUpdate:modelValue":l[1]||(l[1]=n=>_.value.stat_date=n),style:{width:"100%"}},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(ee,{style:{height:"32px"},direction:"vertical"}),e(S,{flex:"86px",style:{"text-align":"right"}},{default:t(()=>[e(te,{direction:"vertical",size:18},{default:t(()=>[e(A,{type:"primary",onClick:G},{icon:t(()=>[e($e)]),default:t(()=>[w(" "+u(a.$t("button.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})),[[R,["reseller","admin"]]]),H(e(ee,{style:{"margin-top":"0","margin-bottom":"16px"}},null,512),[[R,["reseller","admin"]]]),e(F,{style:{"margin-bottom":"16px"}},{default:t(()=>[e(S,{span:12},{default:t(()=>[e(te,null,{default:t(()=>[e(A,{type:"primary",onClick:l[2]||(l[2]=n=>K({}))},{default:t(()=>[w(u(a.$t("button.export")),1)]),_:1})]),_:1})]),_:1}),e(S,{span:12,style:{display:"flex",height:"32px","align-items":"center","justify-content":"end"}},{default:t(()=>[e(P,{content:a.$t("action.refresh")},{default:t(()=>[k("div",{class:"action-icon",onClick:G},[e(Ce,{size:"18"})])]),_:1},8,["content"]),e(De,{onSelect:be},{content:t(()=>[(s(!0),g(oe,null,se(V(me),n=>(s(),$(Ve,{key:n.value,value:n.value,class:We({active:n.value===y.value})},{default:t(()=>[k("span",null,u(n.name),1)]),_:2},1032,["value","class"]))),128))]),default:t(()=>[e(P,{content:a.$t("action.density")},{default:t(()=>[k("div",Bt,[e(Se,{size:"18"})])]),_:1},8,["content"])]),_:1}),e(P,{content:a.$t("action.column_setting")},{default:t(()=>[e(Le,{trigger:"click",position:"bl",onPopupVisibleChange:ge},{content:t(()=>[k("div",Lt,[(s(!0),g(oe,null,se(v.value,(n,ae)=>(s(),g("div",{key:n.dataIndex,class:"setting"},[k("div",Et,[e(Be)]),k("div",null,[e(ze,{modelValue:n.checked,"onUpdate:modelValue":T=>n.checked=T,onChange:T=>ve(T,n,ae)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),k("div",Ut,u(n.title),1)]))),128))])]),default:t(()=>[k("div",zt,[e(Ie,{size:"18"})])]),_:1})]),_:1},8,["content"])]),_:1})]),_:1}),e(Ee,{ref_key:"tableRef",ref:D,"row-key":"id",loading:V(E),pagination:B,columns:p.value,data:m.value,bordered:!1,size:y.value,"row-selection":h,onPageChange:pe,onPageSizeChange:fe,onSelectionChange:he},{total:t(({record:n})=>[w(u(n.total.toLocaleString()),1)]),tokens:t(({record:n})=>[e(O,{"model-value":n.tokens},null,8,["model-value"])]),operations:t(({record:n})=>[e(A,{type:"text",size:"small",onClick:ae=>we(n.id)},{default:t(()=>[w(u(a.$t("button.detail")),1)]),_:2},1032,["onClick"])]),_:1},8,["loading","pagination","columns","data","size","row-selection"]),e(Ue,{title:a.$t("finance.menu.bill.detail"),"unmount-on-close":"","render-to-body":"",width:700,footer:!1,visible:N.value,onCancel:xe},{default:t(()=>[e(Dt,{id:W.value},null,8,["id"])]),_:1},8,["title","visible"]),e(Ne,{visible:I.value,"onUpdate:visible":l[5]||(l[5]=n=>I.value=n),title:a.$t("finance.form.title.bill_export"),onCancel:ke,onBeforeOk:ye},{default:t(()=>[e(X,{ref_key:"billExportForm",ref:Q,model:C.value},{default:t(()=>[e(L,{field:"stat_date",label:a.$t("finance.label.bill.stat_date"),rules:[{required:!0,message:a.$t("finance.error.required.stat_date")}]},{default:t(()=>[e(Z,{modelValue:C.value.stat_date,"onUpdate:modelValue":l[3]||(l[3]=n=>C.value.stat_date=n),style:{width:"100%"}},null,8,["modelValue"])]),_:1},8,["label","rules"]),H((s(),$(L,{field:"user_id",label:a.$t("common.user_id")},{default:t(()=>[e(Y,{modelValue:C.value.user_id,"onUpdate:modelValue":l[4]||(l[4]=n=>C.value.user_id=n),placeholder:a.$t("placeholder.user_id"),precision:0,min:1,"allow-clear":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"])),[[R,["reseller","admin"]]])]),_:1},8,["model"])]),_:1},8,["visible","title"])]),_:1})])}}});const ra=qe(Ft,[["__scopeId","data-v-4dade681"]]);export{ra as default};
