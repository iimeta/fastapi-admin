import{u as ae,N as oe,_ as te}from"./index.dcc2ae0d.js";/* empty css              *//* empty css              *//* empty css               *//* empty css              *//* empty css               *//* empty css               *//* empty css               *//* empty css               *//* empty css               *//* empty css                */import{d as de,e as i,B as p,C as h,aH as o,aG as d,aL as s,aM as u,D as N,aJ as $,aI as w,aD as U,bu as re,bv as se,u as ue,aZ as ne,aK as me,aF as ie,bL as pe,bH as _e,bI as ce,b2 as be,b1 as ve,aS as ge,bT as fe,b4 as ye,bi as he,bP as Ve,aU as ke,aT as $e,a5 as we,a4 as Ue,bQ as Me,b5 as qe,bU as Ce,bV as De}from"./arco.73de4031.js";import{u as Ie}from"./loading.0c20cf1b.js";import{h as Le,f as Be}from"./vue.e54f3d1e.js";import{g as Se,a as Re,f as Ae}from"./model_agent.46a13273.js";import{q as Te}from"./provider.b36a7d3e.js";import{q as Fe}from"./group.ef0ab580.js";import{a as Pe}from"./model.591fcc4b.js";import"./chart.b5ad42b0.js";const Ne={class:"container"},Ge={class:"wrapper"},ze={class:"submit-btn"},Ee={name:"ModelAgentUpdate"},He=de({...Ee,setup(Ke){const{loading:G,setLoading:g}=Ie(!1),z=Le(),E=Be(),{t:m}=ae(),c=i([]),M=new Map,H=async()=>{try{const{data:a}=await Te();c.value=a.items;for(let l=0;l<c.value.length;l+=1)M.set(c.value[l].id,c.value[l])}catch{}},_=i(m("key.placeholder.key")),q=async()=>{switch(M.get(e.value.provider_id).code){case"Baidu":_.value=m("key.placeholder.key.baidu");break;case"Xfyun":_.value=m("key.placeholder.key.xfyun");break;case"DeepSeek-Baidu":_.value=m("key.placeholder.key.deepseek.baidu");break;case"VolcEngine":_.value=m("key.placeholder.key.volcengine");break;default:_.value=m("key.placeholder.key")}},C=i([]);(async()=>{try{const{data:a}=await Fe();C.value=a.items}catch{}})();const D=i([]);(async()=>{try{const{data:a}=await Pe();D.value=a.items}catch{}})();const I=i(),e=i({id:"",provider_id:"",name:"",base_url:"",path:"",weight:i(20),remark:"",status:1,billing_methods:[1,2],groups:[],models:[],is_enable_model_replace:!1,replace_models:[],target_models:[],is_never_disable:!1,lb_strategy:"",key:"",is_agents_only:!0,is_never_disable_key:!1}),K=async()=>{var l;if(!await((l=I.value)==null?void 0:l.validate())){g(!0);try{await Se(e.value).then(()=>{ne.success(m("success.update")),E.push({name:"ModelAgentList"})})}catch{}finally{g(!1)}}};(async(a={id:z.query.id})=>{g(!0);try{H();const{data:l}=await Re(a);e.value.id=l.id,e.value.provider_id=l.provider_id,e.value.name=l.name,e.value.base_url=l.base_url,e.value.path=l.path,e.value.weight=l.weight,e.value.remark=l.remark,e.value.status=l.status,e.value.billing_methods=l.billing_methods,e.value.groups=l.groups,e.value.models=l.models,e.value.is_enable_model_replace=l.is_enable_model_replace,l.replace_models&&(e.value.replace_models=l.replace_models,e.value.target_models=l.target_models),e.value.is_never_disable=l.is_never_disable,e.value.lb_strategy=String(l.lb_strategy),e.value.key=l.key,q()}catch{}finally{g(!1)}})();const Q=()=>{e.value.is_enable_model_replace?L():(e.value.replace_models=[],e.value.target_models=[])},L=()=>{e.value.replace_models.push(""),e.value.target_models.push("")},J=a=>{e.value.replace_models.length>1&&(e.value.replace_models.splice(a,1),e.value.target_models.splice(a,1))},O=async()=>{const{data:a}=await Ae({base_url:e.value.base_url,key:e.value.key});a.models&&(e.value.models=[...new Set([...e.value.models,...a.models])])};return(a,l)=>{const B=oe,V=me,X=ie,S=pe,R=_e,A=ce,r=be,b=ve,Z=ge,T=fe,F=ye,k=he,j=Ve,v=ke,f=$e,W=we,Y=Ue,P=Me,x=qe,ee=Ce,le=De;return p(),h("div",Ne,[o(X,{class:"container-breadcrumb"},{default:d(()=>[o(V,null,{default:d(()=>[o(B)]),_:1}),o(V,null,{default:d(()=>[s(u(a.$t("model.agent.menu")),1)]),_:1}),o(V,null,{default:d(()=>[s(u(a.$t("model.agent.menu.update")),1)]),_:1})]),_:1}),o(le,{loading:ue(G),style:{width:"100%"}},{default:d(()=>[o(ee,{class:"general-card","body-style":{padding:"0 20px 20px 20px"},bordered:!1},{default:d(()=>[N("div",Ge,[o(x,{ref_key:"formRef",ref:I,model:e.value,class:"form","label-col-props":{span:4},"wrapper-col-props":{span:18}},{default:d(()=>[o(S,{orientation:"left"},{default:d(()=>[s(u(a.$t("common.title.base_info")),1)]),_:1}),o(r,{field:"provider_id",label:a.$t("common.provider"),rules:[{required:!0,message:a.$t("placeholder.provider")}]},{default:d(()=>[o(A,{modelValue:e.value.provider_id,"onUpdate:modelValue":l[0]||(l[0]=t=>e.value.provider_id=t),placeholder:a.$t("placeholder.provider"),scrollbar:!1,"allow-search":"",onChange:q},{default:d(()=>[(p(!0),h($,null,w(c.value,t=>(p(),U(R,{key:t.id,value:t.id,label:t.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label","rules"]),o(r,{field:"name",label:a.$t("model.agent.label.name"),rules:[{required:!0,message:a.$t("model.agent.placeholder.name")},{match:/^.{1,100}$/,message:a.$t("model.agent.error.pattern.name")}]},{default:d(()=>[o(b,{modelValue:e.value.name,"onUpdate:modelValue":l[1]||(l[1]=t=>e.value.name=t),placeholder:a.$t("model.agent.placeholder.name")},null,8,["modelValue","placeholder"])]),_:1},8,["label","rules"]),o(r,{field:"base_url",label:a.$t("model.agent.label.base_url"),rules:[{required:!0,message:a.$t("model.agent.error.required.base_url")}]},{default:d(()=>[o(b,{modelValue:e.value.base_url,"onUpdate:modelValue":l[2]||(l[2]=t=>e.value.base_url=t),placeholder:a.$t("model.agent.placeholder.base_url")},null,8,["modelValue","placeholder"])]),_:1},8,["label","rules"]),o(r,{field:"path",label:a.$t("model.agent.label.path")},{default:d(()=>[o(b,{modelValue:e.value.path,"onUpdate:modelValue":l[3]||(l[3]=t=>e.value.path=t),placeholder:a.$t("model.agent.placeholder.path")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(r,{field:"weight",label:a.$t("common.weight")},{default:d(()=>[o(Z,{modelValue:e.value.weight,"onUpdate:modelValue":l[4]||(l[4]=t=>e.value.weight=t),placeholder:a.$t("placeholder.weight"),precision:0,min:0,max:999},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(r,{field:"remark",label:a.$t("common.remark")},{default:d(()=>[o(T,{modelValue:e.value.remark,"onUpdate:modelValue":l[5]||(l[5]=t=>e.value.remark=t),placeholder:a.$t("placeholder.remark")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(S,{orientation:"left"},{default:d(()=>[s(u(a.$t("common.title.advanced")),1)]),_:1}),o(r,{field:"billing_methods",label:a.$t("common.billing_methods"),rules:[{required:!0,message:a.$t("placeholder.billing_methods")}]},{default:d(()=>[o(k,{size:"large"},{default:d(()=>[o(F,{modelValue:e.value.billing_methods,"onUpdate:modelValue":l[6]||(l[6]=t=>e.value.billing_methods=t),value:1},{default:d(()=>[s(u(a.$t("dict.billing_methods.1")),1)]),_:1},8,["modelValue"]),o(F,{modelValue:e.value.billing_methods,"onUpdate:modelValue":l[7]||(l[7]=t=>e.value.billing_methods=t),value:2},{default:d(()=>[s(u(a.$t("dict.billing_methods.2")),1)]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["label","rules"]),o(r,{field:"groups",label:a.$t("common.bind_group")},{default:d(()=>[o(A,{modelValue:e.value.groups,"onUpdate:modelValue":l[8]||(l[8]=t=>e.value.groups=t),placeholder:a.$t("model.agent.placeholder.groups"),"max-tag-count":5,scrollbar:!1,multiple:"","allow-search":"","allow-clear":""},{default:d(()=>[(p(!0),h($,null,w(C.value,t=>(p(),U(R,{key:t.id,value:t.id,label:t.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),o(r,{field:"models",label:a.$t("common.bind_models"),rules:[{required:!1}]},{default:d(()=>[o(j,{modelValue:e.value.models,"onUpdate:modelValue":l[9]||(l[9]=t=>e.value.models=t),placeholder:a.$t("model.agent.placeholder.models"),"allow-search":!0,"allow-clear":!0,"tree-checkable":!0,data:D.value,"max-tag-count":3,scrollbar:!1,"tree-checked-strategy":"child"},null,8,["modelValue","placeholder","data"]),o(v,{onClick:O},{default:d(()=>[s(u(a.$t("model.agent.button.quick_fill")),1)]),_:1})]),_:1},8,["label"]),o(r,{field:"is_enable_model_replace",label:a.$t("model.agent.label.replace_models")},{default:d(()=>[o(f,{modelValue:e.value.is_enable_model_replace,"onUpdate:modelValue":l[10]||(l[10]=t=>e.value.is_enable_model_replace=t),onChange:Q},null,8,["modelValue"])]),_:1},8,["label"]),(p(!0),h($,null,w(e.value.replace_models,(t,n)=>re((p(),U(r,{key:n,field:`replace_models[${n}]`&&`target_models[${n}]`,label:`${n+1}. `+a.$t("model.agent.label.replace_models"),rules:[{required:!0,message:a.$t("model.agent.error.required.replace_models")}]},{default:d(()=>[o(b,{modelValue:e.value.replace_models[n],"onUpdate:modelValue":y=>e.value.replace_models[n]=y,placeholder:a.$t("model.agent.placeholder.replace_models"),style:{width:"43%","margin-right":"5px"}},null,8,["modelValue","onUpdate:modelValue","placeholder"]),o(b,{modelValue:e.value.target_models[n],"onUpdate:modelValue":y=>e.value.target_models[n]=y,placeholder:a.$t("model.agent.placeholder.target_models"),style:{width:"43%","margin-right":"4px"}},null,8,["modelValue","onUpdate:modelValue","placeholder"]),o(v,{type:"primary",shape:"circle",style:{margin:"0 10px 0 10px"},onClick:L},{default:d(()=>[o(W)]),_:1}),o(v,{type:"secondary",shape:"circle",onClick:y=>J(n)},{default:d(()=>[o(Y)]),_:2},1032,["onClick"])]),_:2},1032,["field","label","rules"])),[[se,e.value.is_enable_model_replace]])),128)),o(r,{field:"is_never_disable",label:a.$t("model.agent.label.is_never_disable")},{default:d(()=>[o(f,{modelValue:e.value.is_never_disable,"onUpdate:modelValue":l[11]||(l[11]=t=>e.value.is_never_disable=t)},null,8,["modelValue"])]),_:1},8,["label"]),o(r,{field:"lb_strategy",label:a.$t("model.agent.label.lb_strategy")},{default:d(()=>[o(k,{size:"large"},{default:d(()=>[o(P,{modelValue:e.value.lb_strategy,"onUpdate:modelValue":l[12]||(l[12]=t=>e.value.lb_strategy=t),value:"1","default-checked":!0},{default:d(()=>[s(u(a.$t("dict.lb_strategy.1")),1)]),_:1},8,["modelValue"]),o(P,{modelValue:e.value.lb_strategy,"onUpdate:modelValue":l[13]||(l[13]=t=>e.value.lb_strategy=t),value:"2"},{default:d(()=>[s(u(a.$t("dict.lb_strategy.2")),1)]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["label"]),o(r,{field:"key",label:a.$t("common.key")},{default:d(()=>[o(T,{modelValue:e.value.key,"onUpdate:modelValue":l[14]||(l[14]=t=>e.value.key=t),placeholder:_.value,"auto-size":{minRows:5,maxRows:10}},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(r,{field:"is_agents_only",label:a.$t("model.agent.label.is_agents_only")},{default:d(()=>[o(f,{modelValue:e.value.is_agents_only,"onUpdate:modelValue":l[15]||(l[15]=t=>e.value.is_agents_only=t)},null,8,["modelValue"])]),_:1},8,["label"]),o(r,{field:"is_never_disable_key",label:a.$t("model.agent.label.is_never_disable_key")},{default:d(()=>[o(f,{modelValue:e.value.is_never_disable_key,"onUpdate:modelValue":l[16]||(l[16]=t=>e.value.is_never_disable_key=t)},null,8,["modelValue"])]),_:1},8,["label"]),o(k,null,{default:d(()=>[N("div",ze,[o(v,{type:"secondary",onClick:l[17]||(l[17]=t=>a.$router.push({name:"ModelAgentList"}))},{default:d(()=>[s(u(a.$t("button.cancel")),1)]),_:1}),o(v,{type:"primary",onClick:K},{default:d(()=>[s(u(a.$t("button.submit")),1)]),_:1})])]),_:1})]),_:1},8,["model"])])]),_:1})]),_:1},8,["loading"])])}}});const _l=te(He,[["__scopeId","data-v-6423e43a"]]);export{_l as default};
