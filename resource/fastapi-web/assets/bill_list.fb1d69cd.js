import{u as ie,F as Ae,p as Re,y as Pe,i as qe,z as He,_ as Te}from"./index.b24b4575.js";/* empty css                *//* empty css                *//* empty css               *//* empty css               *//* empty css              *//* empty css                *//* empty css               *//* empty css               *//* empty css                *//* empty css                *//* empty css               *//* empty css               *//* empty css                *//* empty css               *//* empty css                *//* empty css                *//* empty css               *//* empty css               *//* empty css               *//* empty css              */import{d as ce,e as c,B as r,C as h,aH as e,aG as t,u as s,aD as B,aM as d,aL as b,bJ as Oe,bK as je,bL as Me,bN as Je,b_ as Ge,bH as re,r as ae,c as le,w as Ke,bS as We,bu as ne,F as x,aJ as oe,aI as se,D as Qe,n as Xe,aK as Ye,aF as Ze,aS as et,b2 as tt,bC as at,bU as lt,bD as nt,b5 as ot,bE as st,ab as it,aU as ct,bi as rt,bj as dt,bl as ut,bm as _t,b4 as pt,bF as mt,aV as ft,a_ as bt,bI as vt,g as gt}from"./arco.a9260898.js";import{u as de}from"./loading.1f346a94.js";import{q as T}from"./common.df364eef.js";import{q as ht,a as yt,s as kt}from"./finance.c9119c09.js";import{c as H,S as xt}from"./sortable.esm.a0dfbf42.js";/* empty css                *//* empty css                */import"./chart.d103b168.js";import"./vue.ad52ddbe.js";const wt={style:{margin:"10px 0 30px 10px"}},Ct={key:1},$t={key:1},St={key:1},Bt={key:1},Dt={name:"BillDetail"},It=ce({...Dt,props:{id:{type:String,default:""}},setup(O){const E=O,{t:v}=ie(),{loading:$,setLoading:w}=de(!0),o=c({});return(async(p={id:E.id})=>{w(!0);try{const{data:m}=await ht(p);o.value=m}catch{}finally{w(!1)}})(),(p,m)=>{const g=Oe,y=je,C=Me,D=Je,I=Ge,k=re;return r(),h("div",wt,[e(D,{column:2,bordered:"","value-style":{width:"350px",padding:"5px 8px 5px 20px"}},{default:t(()=>[e(C,{label:s(v)("bill.detail.label.stat_date")},{default:t(()=>[s($)?(r(),B(y,{key:0,animation:!0},{default:t(()=>[e(g,{rows:1})]),_:1})):(r(),h("span",Ct,d(o.value.stat_date||"-"),1))]),_:1},8,["label"]),e(C,{label:s(v)("bill.detail.label.user_id")},{default:t(()=>[s($)?(r(),B(y,{key:0,animation:!0},{default:t(()=>[e(g,{rows:1})]),_:1})):(r(),h("span",$t,d(o.value.user_id||"-"),1))]),_:1},8,["label"]),e(C,{label:s(v)("bill.detail.label.total")},{default:t(()=>[s($)?(r(),B(y,{key:0,animation:!0},{default:t(()=>[e(g,{rows:1})]),_:1})):(r(),h("span",St,d(o.value.total.toLocaleString()),1))]),_:1},8,["label"]),e(C,{label:s(v)("bill.detail.label.tokens")},{default:t(()=>[s($)?(r(),B(y,{key:0,animation:!0},{default:t(()=>[e(g,{rows:1})]),_:1})):(r(),h("span",Bt,d(o.value.tokens>0?`$${s(T)(o.value.tokens)}`:"$0.00"),1))]),_:1},8,["label"])]),_:1}),e(k,{style:{"margin-top":"15px"},data:o.value.model_stats,pagination:!1,bordered:!1},{columns:t(()=>[e(I,{title:s(v)("bill.detail.label.model"),"data-index":"model",align:"center"},{cell:t(({record:f})=>[b(d(f.model||"-"),1)]),_:1},8,["title"]),e(I,{title:s(v)("bill.detail.label.total"),"data-index":"total",align:"center"},{cell:t(({record:f})=>[b(d(f.total.toLocaleString()),1)]),_:1},8,["title"]),e(I,{title:s(v)("bill.detail.label.tokens"),"data-index":"tokens",align:"center"},{cell:t(({record:f})=>[b(d(f.tokens>0?`$${s(T)(f.tokens)}`:"$0.00"),1)]),_:1},8,["title"])]),_:1},8,["data"])])}}}),Ft={class:"container"},zt={class:"action-icon"},Vt={class:"action-icon"},Et={id:"tableSetting"},Lt={style:{"margin-right":"4px",cursor:"move"}},Ut={class:"title"},Nt={name:"BillList"},At=ce({...Nt,setup(O){const E=ae({type:"checkbox",showCheckedAll:!0,onlyCurrent:!1}),v=()=>({user_id:c(),stat_date:[]}),{loading:$,setLoading:w}=de(!0),{t:o}=ie(),L=c([]),p=c(v()),m=c([]),g=c([]),y=c("medium"),C=c(),D=c([]),I=c(!0),k={current:1,pageSize:20,showTotal:!0,showPageSize:!0,pageSizeOptions:[20,50,100,500,1e3]},f=ae({...k}),ue=le(()=>[{name:o("size.mini"),value:"mini"},{name:o("size.small"),value:"small"},{name:o("size.medium"),value:"medium"},{name:o("size.large"),value:"large"}]),_e=le(()=>[{title:o("finance.columns.user_id"),dataIndex:"user_id",slotName:"user_id",align:"center"},{title:o("finance.columns.total"),dataIndex:"total",slotName:"total",align:"center"},{title:o("finance.columns.models"),dataIndex:"models",slotName:"models",align:"center"},{title:o("finance.columns.tokens"),dataIndex:"tokens",slotName:"tokens",align:"center"},{title:o("finance.columns.stat_date"),dataIndex:"stat_date",slotName:"stat_date",align:"center"},{title:o("common.operations"),dataIndex:"operations",slotName:"operations",align:"center",width:75}]),z=async(a={...k})=>{w(!0);try{const{data:l}=await yt(a);L.value=l.items,f.current=a.current,f.pageSize=a.pageSize,f.total=l.paging.total}catch{}finally{w(!1)}},j=()=>{z({...k,...p.value})},pe=a=>{z({...k,...p.value,current:a})},me=a=>{k.pageSize=a,z({...k,...p.value})};z();const fe=(a,l)=>{y.value=a},be=(a,l,u)=>{a?m.value.splice(u,0,l):m.value=g.value.filter(_=>_.dataIndex!==l.dataIndex)},M=(a,l,u,_=!1)=>{const i=_?H(a):a;return l>-1&&u>-1&&i.splice(l,1,i.splice(u,1,i[l]).pop()),i},ve=a=>{a&&Xe(()=>{const l=document.getElementById("tableSetting");new xt(l,{onEnd(u){const{oldIndex:_,newIndex:i}=u;M(m.value,_,i),M(g.value,_,i)}})})};Ke(()=>_e.value,a=>{m.value=H(a),m.value.forEach((l,u)=>{l.checked=!0}),g.value=H(m.value)},{deep:!0,immediate:!0});const{proxy:J}=gt(),ge=a=>{D.value=a,I.value=!a.length},G=c(),F=c(!1),V=c({}),he=async a=>{var u;if(await((u=G.value)==null?void 0:u.validate())){F.value=!0,a(!1);return}a(),K({stat_date:V.value.stat_date})},ye=()=>{F.value=!1},K=a=>{if(D.value.length===0&&!a.stat_date){F.value=!0;return}w(!0),a.ids=D.value,kt(a).then(l=>{w(!1),J.$message.success("\u5BFC\u51FA\u6210\u529F"),C.value.selectAll(!1);const u=new Blob([l.data],{type:"application/vnd.ms-excel"}),_=window.URL.createObjectURL(u),i=document.createElement("a");i.href=_,i.setAttribute("download","\u8D26\u5355\u660E\u7EC6.xlsx"),document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(_)}).catch(l=>{J.$message.error("\u5BFC\u51FA\u5931\u8D25, \u8BF7\u8054\u7CFB\u7BA1\u7406\u5458",l)})},U=c(!1),W=c(),ke=a=>{U.value=!0,W.value=a},xe=()=>{U.value=!1};return(a,l)=>{const u=Ae,_=Ye,i=Ze,we=et,N=tt,S=at,Q=lt,A=nt,X=ot,Y=st,Ce=it,R=ct,Z=rt,$e=Re,P=dt,Se=Pe,Be=ut,De=_t,Ie=qe,Fe=He,ze=pt,Ve=mt,Ee=re,Le=ft,Ue=bt,Ne=vt,ee=We("permission");return r(),h("div",Ft,[e(i,{class:"container-breadcrumb"},{default:t(()=>[e(_,null,{default:t(()=>[e(u)]),_:1}),e(_,null,{default:t(()=>[b(d(a.$t("menu.finance")),1)]),_:1}),e(_,null,{default:t(()=>[b(d(a.$t("menu.bill.list")),1)]),_:1})]),_:1}),e(Ne,{class:"general-card",bordered:!1,"header-style":{padding:"20px"},"body-style":{padding:"25px 20px 20px 20px"}},{default:t(()=>[ne((r(),B(A,null,{default:t(()=>[e(S,{flex:1},{default:t(()=>[e(X,{model:p.value,"label-col-props":{span:5},"wrapper-col-props":{span:18},"label-align":"left"},{default:t(()=>[e(A,{gutter:16},{default:t(()=>[e(S,{span:8},{default:t(()=>[e(N,{field:"name",label:a.$t("finance.form.user_id")},{default:t(()=>[e(we,{modelValue:p.value.user_id,"onUpdate:modelValue":l[0]||(l[0]=n=>p.value.user_id=n),placeholder:a.$t("finance.form.user_id.placeholder"),min:1,"allow-clear":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),e(S,{span:8},{default:t(()=>[e(N,{field:"stat_date",label:a.$t("finance.form.stat_date")},{default:t(()=>[e(Q,{modelValue:p.value.stat_date,"onUpdate:modelValue":l[1]||(l[1]=n=>p.value.stat_date=n),style:{width:"100%"}},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(Y,{style:{height:"32px"},direction:"vertical"}),e(S,{flex:"86px",style:{"text-align":"right"}},{default:t(()=>[e(Z,{direction:"vertical",size:18},{default:t(()=>[e(R,{type:"primary",onClick:j},{icon:t(()=>[e(Ce)]),default:t(()=>[b(" "+d(a.$t("finance.form.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})),[[ee,["admin"]]]),ne(e(Y,{style:{"margin-top":"0","margin-bottom":"16px"}},null,512),[[ee,["admin"]]]),e(A,{style:{"margin-bottom":"16px"}},{default:t(()=>[e(S,{span:12},{default:t(()=>[e(Z,null,{default:t(()=>[e(R,{type:"primary",onClick:l[2]||(l[2]=n=>K({}))},{default:t(()=>[b(" \u5BFC\u51FA ")]),_:1})]),_:1})]),_:1}),e(S,{span:12,style:{display:"flex",height:"32px","align-items":"center","justify-content":"end"}},{default:t(()=>[e(P,{content:a.$t("actions.refresh")},{default:t(()=>[x("div",{class:"action-icon",onClick:j},[e($e,{size:"18"})])]),_:1},8,["content"]),e(De,{onSelect:fe},{content:t(()=>[(r(!0),h(oe,null,se(s(ue),n=>(r(),B(Be,{key:n.value,value:n.value,class:Qe({active:n.value===y.value})},{default:t(()=>[x("span",null,d(n.name),1)]),_:2},1032,["value","class"]))),128))]),default:t(()=>[e(P,{content:a.$t("actions.density")},{default:t(()=>[x("div",zt,[e(Se,{size:"18"})])]),_:1},8,["content"])]),_:1}),e(P,{content:a.$t("actions.column_setting")},{default:t(()=>[e(Ve,{trigger:"click",position:"bl",onPopupVisibleChange:ve},{content:t(()=>[x("div",Et,[(r(!0),h(oe,null,se(g.value,(n,te)=>(r(),h("div",{key:n.dataIndex,class:"setting"},[x("div",Lt,[e(Fe)]),x("div",null,[e(ze,{modelValue:n.checked,"onUpdate:modelValue":q=>n.checked=q,onChange:q=>be(q,n,te)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),x("div",Ut,d(n.title==="#"?"\u5E8F\u5217\u53F7":n.title),1)]))),128))])]),default:t(()=>[x("div",Vt,[e(Ie,{size:"18"})])]),_:1})]),_:1},8,["content"])]),_:1})]),_:1}),e(Ee,{ref_key:"tableRef",ref:C,"row-key":"id",loading:s($),pagination:f,columns:m.value,data:L.value,bordered:!1,size:y.value,"row-selection":E,onPageChange:pe,onPageSizeChange:me,onSelectionChange:ge},{total:t(({record:n})=>[b(d(n.total.toLocaleString()),1)]),tokens:t(({record:n})=>[b(d(n.tokens>0?`$${s(T)(n.tokens)}`:"$0.00"),1)]),operations:t(({record:n})=>[e(R,{type:"text",size:"small",onClick:te=>ke(n.id)},{default:t(()=>[b(d(a.$t("operations.view")),1)]),_:2},1032,["onClick"])]),_:1},8,["loading","pagination","columns","data","size","row-selection"]),e(Le,{title:a.$t("menu.bill.detail"),"unmount-on-close":"","render-to-body":"",width:700,footer:!1,visible:U.value,onCancel:xe},{default:t(()=>[e(It,{id:W.value},null,8,["id"])]),_:1},8,["title","visible"]),e(Ue,{visible:F.value,"onUpdate:visible":l[4]||(l[4]=n=>F.value=n),title:a.$t("finance.form.title.bill_export"),onCancel:ye,onBeforeOk:he},{default:t(()=>[e(X,{ref_key:"billExportForm",ref:G,model:V.value},{default:t(()=>[e(N,{field:"stat_date",label:a.$t("finance.form.stat_date"),rules:[{required:!0,message:a.$t("finance.error.stat_date.required")}]},{default:t(()=>[e(Q,{modelValue:V.value.stat_date,"onUpdate:modelValue":l[3]||(l[3]=n=>V.value.stat_date=n),style:{width:"100%"}},null,8,["modelValue"])]),_:1},8,["label","rules"])]),_:1},8,["model"])]),_:1},8,["visible","title"])]),_:1})])}}});const ma=Te(At,[["__scopeId","data-v-4b58c2ca"]]);export{ma as default};
