import{b as L,a as z,J as ne,_ as F,u as A,k as le}from"./index.b8904415.js";/* empty css               *//* empty css               */import{d as U,e as C,B as S,aD as E,aG as t,aH as e,C as B,aE as ue,u as I,aL as v,aM as _,bk as ie,c2 as ce,b$ as de,bO as pe,bi as K,bJ as me,r as N,c as R,t as _e,b1 as W,b2 as x,aU as G,b5 as J,g as M,F as V,aJ as H,bY as Y,b7 as j,c3 as Q,b3 as X,a_ as Z,c4 as fe,c5 as ge,aK as be,aF as we,bC as ve,bE as he,ba as ye,b6 as Ce}from"./arco.17b1a46f.js";/* empty css               *//* empty css                *//* empty css                *//* empty css              *//* empty css               *//* empty css               *//* empty css              *//* empty css               *//* empty css               *//* empty css               *//* empty css                *//* empty css              */import{g as Pe}from"./common.e6772b36.js";import"./chart.d5ce7f1f.js";import"./vue.32c094a4.js";function Se(b){return L.post("/api/v1/user/update/info",b)}function $e(b){return L.post("/api/v1/user/change/password",b)}function Ie(b){return L.post("/api/v1/user/change/email",b)}function ke(b,u){return L.post("/api/v1/user/change/avatar",b,u)}const Ve=["src"],Ee={key:1},Ue=U({__name:"user-panel",setup(b){const u=z(),r={uid:"-2",name:"avatar.png",url:u.avatar||"https://www.fastapi.ai/logo.png"},m=[{label:"userCenter.label.userId",value:u.user_id},{label:"userCenter.label.account",value:u.account},{label:"userCenter.label.name",value:u.name},{label:"userCenter.label.email",value:u.email},{label:"userCenter.label.createdAt",value:u.created_at}],o=C([r]),i=(l,p)=>{o.value=[p]},n=l=>{const p=new AbortController;return async function(){const{onProgress:f,onError:a,onSuccess:s,fileItem:$,name:y="file"}=l;f(20);const P=new FormData;P.append(y,$.file);const g=c=>{let k;c.total>0&&(k=c.loaded/c.total*100),f(parseInt(String(k),10),c)};try{const c=await ke(P,{controller:p,onUploadProgress:g});s(c)}catch(c){a(c)}}(),{abort(){p.abort()}}};return(l,p)=>{const h=ne,f=ie,a=ce,s=de,$=pe,y=K,P=me;return S(),E(P,{bordered:!1},{default:t(()=>[e(y,{size:54},{default:t(()=>[e(a,{"custom-request":n,"list-type":"picture-card","file-list":o.value,"show-upload-button":!0,"show-file-list":!1,onChange:i},{"upload-button":t(()=>[e(f,{size:100,class:"info-avatar"},{"trigger-icon":t(()=>[e(h)]),default:t(()=>[o.value.length?(S(),B("img",{key:0,src:o.value[0].url},null,8,Ve)):ue("",!0)]),_:1})]),_:1},8,["file-list"]),e($,{data:I(m),column:2,align:"right",layout:"inline-horizontal","label-style":{width:"140px",fontWeight:"normal",color:"rgb(var(--gray-8))"},"value-style":{width:"200px",paddingLeft:"8px",textAlign:"left"}},{label:t(({label:g})=>[v(_(l.$t(g))+" :",1)]),value:t(({value:g,data:c})=>[c.label==="userCenter.label.certification"?(S(),E(s,{key:0,color:"green",size:"small"},{default:t(()=>[v(" \u5DF2\u8BA4\u8BC1 ")]),_:1})):(S(),B("span",Ee,_(g),1))]),_:1},8,["data","label-style"])]),_:1})]),_:1})}}});const qe=F(Ue,[["__scopeId","data-v-9bff78c5"]]),Be=U({__name:"basic-information",setup(b){const{proxy:u}=M(),{t:r}=A(),m=C(),o=z(),i=C(!1),n=N({form:{name:o.name},rules:R(()=>({name:[{required:!0,message:r("userCenter.basicInfo.form.error.required.name")}]}))}),{form:l,rules:p}=_e(n),h=()=>{i.value||m.value.validate(a=>{a||(i.value=!0,Se({name:l.value.name}).then(()=>{o.info(),u.$message.success(r("userCenter.basicInfo.form.save.success"))}).finally(()=>{i.value=!1}))})},f=()=>{m.value.resetFields()};return(a,s)=>{const $=W,y=x,P=G,g=K,c=J;return S(),E(c,{ref_key:"formRef",ref:m,model:I(l),rules:I(p),"label-col-props":{span:8},"wrapper-col-props":{span:16},size:"large",class:"form"},{default:t(()=>[e(y,{label:a.$t("userCenter.basicInfo.form.label.name"),field:"name"},{default:t(()=>[e($,{modelValue:I(l).name,"onUpdate:modelValue":s[0]||(s[0]=k=>I(l).name=k),placeholder:a.$t("userCenter.basicInfo.form.placeholder.name"),"max-length":30},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(y,null,{default:t(()=>[e(g,null,{default:t(()=>[e(P,{loading:i.value,type:"primary",onClick:h},{default:t(()=>[v(_(a.$t("userCenter.basicInfo.form.save")),1)]),_:1},8,["loading"]),e(P,{onClick:f},{default:t(()=>[v(_(a.$t("userCenter.basicInfo.form.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])}}});const Fe=F(Be,[["__scopeId","data-v-d5a4edb8"]]);const Re={class:"tip"},Le={class:"content"},ze={class:"operation"},De=U({__name:"update-pwd",setup(b){const{proxy:u}=M(),{t:r}=A(),m=z(),o=C(),i=C(!1),n=N({oldPassword:"",newPassword:"",rePassword:""}),l=R(()=>({oldPassword:[{required:!0,message:r("userCenter.securitySettings.updatePwd.form.error.required.oldPassword")}],newPassword:[{required:!0,message:r("userCenter.securitySettings.updatePwd.form.error.required.newPassword")},{match:/^(?=.*\d)(?=.*[a-z]).{6,32}$/,message:r("userCenter.securitySettings.updatePwd.form.error.match.newPassword")},{validator:(a,s)=>{a===n.oldPassword?s(r("userCenter.securitySettings.updatePwd.form.error.validator.newPassword")):s()}}],rePassword:[{required:!0,message:r("userCenter.securitySettings.updatePwd.form.error.required.rePassword")},{validator:(a,s)=>{a!==n.newPassword?s(r("userCenter.securitySettings.updatePwd.form.error.validator.rePassword")):s()}}]})),p=()=>{i.value=!1,o.value.resetFields()},h=()=>{o.value.validate(a=>{a||$e({old_password:n.oldPassword,new_password:n.newPassword}).then(()=>{m.info(),p(),u.$message.success(r("userCenter.basicInfo.form.change.success"))})})},f=()=>{i.value=!0};return(a,s)=>{const $=Y,y=j,P=Q,g=X,c=x,k=J,d=Z;return S(),B(H,null,[e(P,null,{avatar:t(()=>[e($,null,{default:t(()=>[v(_(a.$t("userCenter.securitySettings.password.label")),1)]),_:1})]),description:t(()=>[V("div",Re,_(a.$t("userCenter.securitySettings.password.tip")),1),V("div",Le,[e($,null,{default:t(()=>[v(_(a.$t("userCenter.securitySettings.content.hasBeenSet")),1)]),_:1})]),V("div",ze,[e(y,{title:a.$t("userCenter.securitySettings.button.update"),onClick:f},{default:t(()=>[v(_(a.$t("userCenter.securitySettings.button.update")),1)]),_:1},8,["title"])])]),_:1}),e(d,{title:a.$t("userCenter.securitySettings.updatePwd.modal.title"),visible:i.value,"mask-closable":!1,"esc-to-close":!1,onOk:h,onCancel:p},{default:t(()=>[e(k,{ref_key:"formRef",ref:o,model:n,rules:I(l),size:"large"},{default:t(()=>[e(c,{label:a.$t("userCenter.securitySettings.updatePwd.form.label.oldPassword"),field:"oldPassword"},{default:t(()=>[e(g,{modelValue:n.oldPassword,"onUpdate:modelValue":s[0]||(s[0]=w=>n.oldPassword=w),placeholder:a.$t("userCenter.securitySettings.updatePwd.form.placeholder.oldPassword"),"max-length":32,"allow-clear":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(c,{label:a.$t("userCenter.securitySettings.updatePwd.form.label.newPassword"),field:"newPassword"},{default:t(()=>[e(g,{modelValue:n.newPassword,"onUpdate:modelValue":s[1]||(s[1]=w=>n.newPassword=w),placeholder:a.$t("userCenter.securitySettings.updatePwd.form.placeholder.newPassword"),"max-length":32,"allow-clear":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(c,{label:a.$t("userCenter.securitySettings.updatePwd.form.label.rePassword"),field:"rePassword"},{default:t(()=>[e(g,{modelValue:n.rePassword,"onUpdate:modelValue":s[2]||(s[2]=w=>n.rePassword=w),placeholder:a.$t("userCenter.securitySettings.updatePwd.form.placeholder.rePassword"),"max-length":32,"allow-clear":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["title","visible"])],64)}}}),Te={class:"tip"},Ae={class:"content"},Ne={class:"operation"},xe=U({__name:"update-email",setup(b){const{proxy:u}=M(),{t:r}=A(),m=z(),o=C(),i=C(60),n=C(),l=C(!1),p=C(!1),h=C(!1),f=C("userCenter.securitySettings.captcha.get"),a=R(()=>r(f.value)),s=N({email:"",code:"",password:""}),$=R(()=>({newEmail:[{required:!0,message:r("userCenter.securitySettings.updateEmail.form.error.required.newEmail")},{type:"email",message:r("userCenter.securitySettings.updateEmail.form.error.match.newEmail")}],captcha:[{required:!0,message:r("userCenter.securitySettings.form.error.required.captcha")}],currentPassword:[{required:!0,message:r("userCenter.securitySettings.updateEmail.form.error.required.currentPassword")}]})),y=()=>{window.clearInterval(n.value),i.value=60,f.value="userCenter.securitySettings.captcha.get",p.value=!1},P=()=>{l.value||o.value.validateField("newEmail",d=>{d||(l.value=!0,f.value="userCenter.securitySettings.captcha.ing",Pe({email:s.email,channel:"change_email"}).then(w=>{l.value=!1,p.value=!0,f.value=`${r("userCenter.securitySettings.captcha.get")}(${i.value-=1}s)`,n.value=window.setInterval(()=>{i.value-=1,f.value=`${r("userCenter.securitySettings.captcha.get")}(${i.value}s)`,i.value<=0&&y()},1e3)}).catch(()=>{y(),l.value=!1}))})},g=()=>{h.value=!1,o.value.resetFields(),y()},c=()=>{o.value.validate(d=>{d||Ie({email:s.email,code:s.code,password:s.password}).then(()=>{g(),m.info(),u.$message.success(r("userCenter.basicInfo.form.save.success"))})})},k=()=>{h.value=!0};return(d,w)=>{const D=Y,ee=j,te=Q,O=W,T=x,ae=G,se=X,re=J,oe=Z;return S(),B(H,null,[e(te,null,{avatar:t(()=>[e(D,null,{default:t(()=>[v(_(d.$t("userCenter.securitySettings.email.label")),1)]),_:1})]),description:t(()=>[V("div",Te,_(d.$t("userCenter.securitySettings.email.tip")),1),V("div",Ae,[I(m).email?(S(),E(D,{key:0},{default:t(()=>[v(_(I(m).email),1)]),_:1})):(S(),E(D,{key:1,class:"tip"},{default:t(()=>[v(_(d.$t("userCenter.securitySettings.email.content")),1)]),_:1}))]),V("div",Ne,[e(ee,{title:d.$t("userCenter.securitySettings.button.update"),onClick:k},{default:t(()=>[v(_(d.$t("userCenter.securitySettings.button.update")),1)]),_:1},8,["title"])])]),_:1}),e(oe,{title:d.$t("userCenter.securitySettings.updateEmail.modal.title"),visible:h.value,"mask-closable":!1,"esc-to-close":!1,onOk:c,onCancel:g},{default:t(()=>[e(re,{ref_key:"formRef",ref:o,model:s,rules:I($),size:"large"},{default:t(()=>[e(T,{label:d.$t("userCenter.securitySettings.updateEmail.form.label.email"),field:"email"},{default:t(()=>[e(O,{modelValue:s.email,"onUpdate:modelValue":w[0]||(w[0]=q=>s.email=q),placeholder:d.$t("userCenter.securitySettings.updateEmail.form.placeholder.email"),"allow-clear":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(T,{label:d.$t("userCenter.securitySettings.updateEmail.form.label.captcha"),field:"code"},{default:t(()=>[e(O,{modelValue:s.code,"onUpdate:modelValue":w[1]||(w[1]=q=>s.code=q),placeholder:d.$t("userCenter.securitySettings.form.placeholder.captcha"),"max-length":6,"allow-clear":"",style:{width:"80%"}},null,8,["modelValue","placeholder"]),e(ae,{loading:l.value,type:"primary",disabled:p.value,class:"captcha-btn",onClick:P},{default:t(()=>[v(_(I(a)),1)]),_:1},8,["loading","disabled"])]),_:1},8,["label"]),e(T,{label:d.$t("userCenter.securitySettings.updateEmail.form.label.currentPassword"),field:"password"},{default:t(()=>[e(se,{modelValue:s.password,"onUpdate:modelValue":w[2]||(w[2]=q=>s.password=q),placeholder:d.$t("userCenter.securitySettings.updateEmail.form.placeholder.currentPassword"),"max-length":32,"allow-clear":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["title","visible"])],64)}}});const Je=F(xe,[["__scopeId","data-v-77afb8b2"]]),Me=U({__name:"security-settings",setup(b){return(u,r)=>{const m=fe,o=ge;return S(),E(o,{bordered:!1},{default:t(()=>[e(m,null,{default:t(()=>[e(De)]),_:1}),e(m,null,{default:t(()=>[e(Je)]),_:1})]),_:1})}}});const Oe=F(Me,[["__scopeId","data-v-c0dda919"]]),Ke={class:"container"},We={name:"Setting"},Ge=U({...We,setup(b){return(u,r)=>{const m=le,o=be,i=we,n=ve,l=he,p=ye,h=Ce;return S(),B("div",Ke,[e(i,{class:"container-breadcrumb"},{default:t(()=>[e(o,null,{default:t(()=>[e(m)]),_:1}),e(o,null,{default:t(()=>[v(_(u.$t("menu.user.center")),1)]),_:1})]),_:1}),e(l,{style:{"margin-bottom":"16px"}},{default:t(()=>[e(n,{span:24},{default:t(()=>[e(qe)]),_:1})]),_:1}),e(l,{class:"wrapper"},{default:t(()=>[e(n,{span:24},{default:t(()=>[e(h,{"default-active-key":"1",type:"rounded"},{default:t(()=>[e(p,{key:"1",title:u.$t("userCenter.tab.basicInformation")},{default:t(()=>[e(Fe)]),_:1},8,["title"]),e(p,{key:"2",title:u.$t("userCenter.tab.securitySettings")},{default:t(()=>[e(Oe)]),_:1},8,["title"])]),_:1})]),_:1})]),_:1})])}}});const mt=F(Ge,[["__scopeId","data-v-dcd276b2"]]);export{mt as default};
