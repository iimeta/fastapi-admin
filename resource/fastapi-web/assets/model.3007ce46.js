import{u as Te,C as Re,p as je,y as Ge,i as Je,z as Qe,_ as We}from"./index.6c4129d6.js";/* empty css                *//* empty css                *//* empty css               *//* empty css               *//* empty css              *//* empty css                *//* empty css               *//* empty css               *//* empty css                *//* empty css                *//* empty css               *//* empty css               *//* empty css                *//* empty css                *//* empty css               *//* empty css                *//* empty css                *//* empty css               *//* empty css               */import{d as Xe,r as ue,e as s,c as R,w as ie,B as r,C as v,aH as a,aG as l,aL as i,aM as d,aJ as I,aI as D,aD as q,u as L,F as k,D as Ye,g as Ze,n as et,aK as tt,aF as at,bA as lt,bB as ot,b2 as nt,bC as st,b1 as ut,bD as it,b5 as dt,bE as rt,ab as ct,aU as mt,bi as pt,bj as _t,bl as ft,bm as yt,b4 as gt,bF as vt,ad as kt,aT as ht,bG as bt,bH as Ct,aV as wt,a_ as $t,bI as Vt}from"./arco.91d8d802.js";import{h as Ft,u as It}from"./vue.90059513.js";import{u as Dt}from"./loading.d8a03711.js";import{q as xt}from"./common.df364eef.js";import{s as Et,q as St,a as zt,b as Bt,c as At}from"./key.42b3e040.js";import{c as j,S as qt}from"./sortable.esm.2649578f.js";import{q as Lt}from"./model.c6cbbe25.js";import{f as Nt}from"./agent.3b6184d9.js";import{q as Ut}from"./corp.b1ff579d.js";import{M as Mt}from"./models.d5763930.js";import{_ as Kt}from"./index.vue_vue_type_script_setup_true_lang.509a04dd.js";import"./chart.1c4d013e.js";/* empty css                *//* empty css                */const Pt={class:"container"},Ot={class:"action-icon"},Ht={class:"action-icon"},Tt={id:"tableSetting"},Rt={style:{"margin-right":"4px",cursor:"move"}},jt={class:"title"},Gt={key:0},Jt={key:1},Qt={name:"KeyList"},Wt=Xe({...Qt,setup(Xt){const{loading:de,setLoading:m}=Dt(!0),{proxy:w}=Ze(),x=Ft(),re=ue({type:"checkbox",showCheckedAll:!0,onlyCurrent:!1}),G=s([]);(async()=>{m(!0);try{const{data:e}=await Ut();G.value=e.items}catch{}finally{m(!1)}})();const J=s([]);(async()=>{try{const{data:e}=await Lt();J.value=e.items}catch{}})();const Q=s([]);(async()=>{try{const{data:e}=await Nt();Q.value=e.items;const o=new Array(0);x.query.agent_id&&(o[0]=x.query.agent_id,n.value.model_agents=o)}catch{}})();const ce=async e=>{m(!0);try{await Et(e),w.$message.success("\u5220\u9664\u6210\u529F"),F()}catch{}finally{m(!1)}},W=()=>({type:2,corp:"",key:"",models:[],model_agents:s(),quota:s(),status:s(),remark:""}),{t:u}=Te(),X=s([]),n=s(W()),h=s([]),E=s([]),N=s("medium"),b=s([]),C=s(!0),Y=s(),$={current:1,pageSize:20,showTotal:!0,showPageSize:!0,pageSizeOptions:[20,50,100,500,1e3]},S=ue({...$}),me=R(()=>[{name:u("size.mini"),value:"mini"},{name:u("size.small"),value:"small"},{name:u("size.medium"),value:"medium"},{name:u("size.large"),value:"large"}]),pe=R(()=>[{title:u("key.columns.corp"),dataIndex:"corp_name",slotName:"corp_name",align:"center",width:110},{title:u("key.columns.key"),dataIndex:"key",slotName:"key",align:"center",width:230},{title:u("key.columns.models"),dataIndex:"model_names",slotName:"model_names",align:"center",ellipsis:!0,tooltip:!0},{title:u("key.columns.model_agents"),dataIndex:"model_agent_names",slotName:"model_agent_names",align:"center",ellipsis:!0,tooltip:!0},{title:u("key.columns.used_quota"),dataIndex:"used_quota",slotName:"used_quota",align:"center",ellipsis:!0,tooltip:!0},{title:u("common.weight"),dataIndex:"weight",slotName:"weight",align:"center",width:60},{title:u("key.columns.remark"),dataIndex:"remark",slotName:"remark",align:"center",ellipsis:!0,tooltip:!0},{title:u("key.columns.status"),dataIndex:"status",slotName:"status",align:"center",width:65},{title:u("key.columns.updated_at"),dataIndex:"updated_at",slotName:"updated_at",align:"center",width:132},{title:u("key.columns.operations"),dataIndex:"operations",slotName:"operations",align:"center",width:170}]),_e=R(()=>[{label:u("key.dict.status.1"),value:1},{label:u("key.dict.status.2"),value:2}]),Z=new Array(0);x.query.agent_id&&(Z[0]=x.query.agent_id);const z=async(e={...$,type:2,model_agents:Z})=>{m(!0);try{const{data:o}=await St(e);X.value=o.items,S.current=e.current,S.pageSize=e.pageSize,S.total=o.paging.total}catch{}finally{m(!1)}},F=()=>{z({...$,...n.value})},fe=e=>{z({...$,...n.value,current:e})},ye=e=>{$.pageSize=e,z({...$,...n.value})};z();const ge=()=>{n.value=W()},ve=async e=>{m(!0);try{await zt(e),w.$message.success("\u64CD\u4F5C\u6210\u529F"),F()}catch{}finally{m(!1)}},ke=(e,o)=>{N.value=e},he=(e,o,p)=>{e?h.value.splice(p,0,o):h.value=E.value.filter(_=>_.dataIndex!==o.dataIndex)},ee=(e,o,p,_=!1)=>{const g=_?j(e):e;return o>-1&&p>-1&&g.splice(o,1,g.splice(p,1,g[o]).pop()),g},be=e=>{e&&et(()=>{const o=document.getElementById("tableSetting");new qt(o,{onEnd(p){const{oldIndex:_,newIndex:g}=p;ee(h.value,_,g),ee(E.value,_,g)}})})};ie(()=>pe.value,e=>{h.value=j(e),h.value.forEach((o,p)=>{o.checked=!0}),E.value=j(h.value)},{deep:!0,immediate:!0});const Ce=e=>{b.value=e,C.value=!e.length},U=e=>{if(b.value.length===0)w.$message.info("\u8BF7\u9009\u62E9\u8981\u64CD\u4F5C\u7684\u6570\u636E");else{let o=`\u662F\u5426\u786E\u5B9A\u64CD\u4F5C\u6240\u9009\u7684${b.value.length}\u6761\u6570\u636E?`;switch(e.action){case"status":e.value===1?o=`\u662F\u5426\u786E\u5B9A\u542F\u7528\u6240\u9009\u7684${b.value.length}\u6761\u6570\u636E?`:o=`\u662F\u5426\u786E\u5B9A\u7981\u7528\u6240\u9009\u7684${b.value.length}\u6761\u6570\u636E?`;break;case"delete":o=`\u662F\u5426\u786E\u5B9A\u5220\u9664\u6240\u9009\u7684${b.value.length}\u6761\u6570\u636E?`;break}w.$modal.warning({title:"\u8B66\u544A",titleAlign:"center",content:o,hideCancel:!1,onOk:()=>{m(!0),e.ids=b.value,Bt(e).then(p=>{m(!1),w.$message.success("\u64CD\u4F5C\u6210\u529F"),F(),Y.value.selectAll(!1)})}})}},{copy:we,copied:te}=It(),$e=async e=>{const{data:o}=await At({id:e});we(o.key)};ie(te,()=>{te.value&&w.$message.success("\u590D\u5236\u6210\u529F")});const M=s(!1),B=s(),Ve=e=>{M.value=!0,B.value=e},Fe=()=>{M.value=!1},K=s(!1),ae=s(),Ie=e=>{K.value=!0,B.value=e,ae.value="key"};return(e,o)=>{const p=Re,_=tt,g=at,P=lt,A=ot,V=nt,f=st,le=ut,O=it,De=dt,oe=rt,xe=ct,y=mt,ne=je,se=pt,H=_t,Ee=Ge,Se=ft,ze=yt,Be=Je,Ae=Qe,qe=gt,Le=vt,Ne=kt,Ue=ht,Me=bt,Ke=Ct,Pe=wt,Oe=$t,He=Vt;return r(),v("div",Pt,[a(g,{class:"container-breadcrumb"},{default:l(()=>[a(_,null,{default:l(()=>[a(p)]),_:1}),a(_,null,{default:l(()=>[i(d(e.$t("menu.key")),1)]),_:1}),a(_,null,{default:l(()=>[i(d(e.$t("menu.key.model.list")),1)]),_:1})]),_:1}),a(He,{class:"general-card",bordered:!1,"header-style":{padding:"20px"},"body-style":{padding:"25px 20px 20px 20px"}},{default:l(()=>[a(O,null,{default:l(()=>[a(f,{flex:1},{default:l(()=>[a(De,{model:n.value,"label-col-props":{span:5},"wrapper-col-props":{span:18},"label-align":"left"},{default:l(()=>[a(O,{gutter:16},{default:l(()=>[a(f,{span:8},{default:l(()=>[a(V,{field:"corp",label:e.$t("key.form.corp")},{default:l(()=>[a(A,{modelValue:n.value.corp,"onUpdate:modelValue":o[0]||(o[0]=t=>n.value.corp=t),placeholder:e.$t("key.form.selectDefault"),"allow-search":"","allow-clear":""},{default:l(()=>[(r(!0),v(I,null,D(G.value,t=>(r(),q(P,{key:t.id,value:t.id,label:t.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),a(f,{span:8},{default:l(()=>[a(V,{field:"key",label:e.$t("key.form.key")},{default:l(()=>[a(le,{modelValue:n.value.key,"onUpdate:modelValue":o[1]||(o[1]=t=>n.value.key=t),placeholder:e.$t("key.form.key.placeholder"),"allow-clear":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),a(f,{span:8},{default:l(()=>[a(V,{field:"models",label:e.$t("key.form.models")},{default:l(()=>[a(A,{modelValue:n.value.models,"onUpdate:modelValue":o[2]||(o[2]=t=>n.value.models=t),placeholder:e.$t("key.form.selectDefault"),"max-tag-count":2,multiple:"","allow-search":"","allow-clear":""},{default:l(()=>[(r(!0),v(I,null,D(J.value,t=>(r(),q(P,{key:t.id,value:t.id,label:t.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),a(f,{span:8},{default:l(()=>[a(V,{field:"model_agents",label:e.$t("key.form.modelAgents")},{default:l(()=>[a(A,{modelValue:n.value.model_agents,"onUpdate:modelValue":o[3]||(o[3]=t=>n.value.model_agents=t),placeholder:e.$t("key.form.selectDefault"),"max-tag-count":2,multiple:"","allow-search":"","allow-clear":""},{default:l(()=>[(r(!0),v(I,null,D(Q.value,t=>(r(),q(P,{key:t.id,value:t.id,label:t.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),a(f,{span:8},{default:l(()=>[a(V,{field:"status",label:e.$t("key.form.status")},{default:l(()=>[a(A,{modelValue:n.value.status,"onUpdate:modelValue":o[4]||(o[4]=t=>n.value.status=t),options:L(_e),placeholder:e.$t("key.form.selectDefault"),"allow-clear":""},null,8,["modelValue","options","placeholder"])]),_:1},8,["label"])]),_:1}),a(f,{span:8},{default:l(()=>[a(V,{field:"remark",label:e.$t("key.form.remark")},{default:l(()=>[a(le,{modelValue:n.value.remark,"onUpdate:modelValue":o[5]||(o[5]=t=>n.value.remark=t),placeholder:e.$t("key.form.remark.placeholder"),"allow-clear":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(oe,{style:{height:"84px"},direction:"vertical"}),a(f,{flex:"86px",style:{"text-align":"right"}},{default:l(()=>[a(se,{direction:"vertical",size:18},{default:l(()=>[a(y,{type:"primary",onClick:F},{icon:l(()=>[a(xe)]),default:l(()=>[i(" "+d(e.$t("key.form.search")),1)]),_:1}),a(y,{onClick:ge},{icon:l(()=>[a(ne)]),default:l(()=>[i(" "+d(e.$t("key.form.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1}),a(oe,{style:{"margin-top":"0","margin-bottom":"16px"}}),a(O,{style:{"margin-bottom":"16px"}},{default:l(()=>[a(f,{span:12},{default:l(()=>[a(se,null,{default:l(()=>[a(y,{type:"primary",onClick:o[6]||(o[6]=t=>e.$router.push({name:"KeyCreate"}))},{default:l(()=>[i(d(e.$t("key.operation.create")),1)]),_:1}),a(y,{type:"primary",status:"success",disabled:C.value,title:C.value?"\u8BF7\u9009\u62E9\u8981\u64CD\u4F5C\u7684\u6570\u636E":"",onClick:o[7]||(o[7]=t=>U({action:"status",value:1}))},{default:l(()=>[i(" \u542F\u7528 ")]),_:1},8,["disabled","title"]),a(y,{type:"primary",status:"danger",disabled:C.value,title:C.value?"\u8BF7\u9009\u62E9\u8981\u64CD\u4F5C\u7684\u6570\u636E":"",onClick:o[8]||(o[8]=t=>U({action:"status",value:2}))},{default:l(()=>[i(" \u7981\u7528 ")]),_:1},8,["disabled","title"]),a(y,{type:"primary",status:"danger",disabled:C.value,title:C.value?"\u8BF7\u9009\u62E9\u8981\u64CD\u4F5C\u7684\u6570\u636E":"",onClick:o[9]||(o[9]=t=>U({action:"delete"}))},{default:l(()=>[i(" \u5220\u9664 ")]),_:1},8,["disabled","title"])]),_:1})]),_:1}),a(f,{span:12,style:{display:"flex",height:"32px","align-items":"center","justify-content":"end"}},{default:l(()=>[a(H,{content:e.$t("actions.refresh")},{default:l(()=>[k("div",{class:"action-icon",onClick:F},[a(ne,{size:"18"})])]),_:1},8,["content"]),a(ze,{onSelect:ke},{content:l(()=>[(r(!0),v(I,null,D(L(me),t=>(r(),q(Se,{key:t.value,value:t.value,class:Ye({active:t.value===N.value})},{default:l(()=>[k("span",null,d(t.name),1)]),_:2},1032,["value","class"]))),128))]),default:l(()=>[a(H,{content:e.$t("actions.density")},{default:l(()=>[k("div",Ot,[a(Ee,{size:"18"})])]),_:1},8,["content"])]),_:1}),a(H,{content:e.$t("actions.column_setting")},{default:l(()=>[a(Le,{trigger:"click",position:"bl",onPopupVisibleChange:be},{content:l(()=>[k("div",Tt,[(r(!0),v(I,null,D(E.value,(t,c)=>(r(),v("div",{key:t.dataIndex,class:"setting"},[k("div",Rt,[a(Ae)]),k("div",null,[a(qe,{modelValue:t.checked,"onUpdate:modelValue":T=>t.checked=T,onChange:T=>he(T,t,c)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),k("div",jt,d(t.title==="#"?"\u5E8F\u5217\u53F7":t.title),1)]))),128))])]),default:l(()=>[k("div",Ht,[a(Be,{size:"18"})])]),_:1})]),_:1},8,["content"])]),_:1})]),_:1}),a(Ke,{ref_key:"tableRef",ref:Y,"row-key":"id",loading:L(de),pagination:S,columns:h.value,data:X.value,bordered:!1,size:N.value,"row-selection":re,onPageChange:fe,onPageSizeChange:ye,onSelectionChange:Ce},{key:l(({record:t})=>[i(d(t.key.length>11?t.key.substr(0,10)+t.key.substr(-10):t.key)+" ",1),a(Ne,{class:"copy-btn",onClick:c=>$e(t.id)},null,8,["onClick"])]),model_names:l(({record:t})=>[t.model_names?(r(),v("span",Gt,[a(y,{type:"text",size:"small",onClick:c=>Ie(t.id)},{default:l(()=>[i(" \u67E5\u770B ")]),_:2},1032,["onClick"])])):(r(),v("span",Jt,d("-")))]),model_agent_names:l(({record:t})=>{var c;return[i(d(((c=t==null?void 0:t.model_agent_names)==null?void 0:c.join(","))||"-"),1)]}),used_quota:l(({record:t})=>[i(" $"+d(t.used_quota>0?L(xt)(t.used_quota):"0.00"),1)]),remark:l(({record:t})=>[i(d(t.remark||"-"),1)]),status:l(({record:t})=>[a(Ue,{modelValue:t.status,"onUpdate:modelValue":c=>t.status=c,"checked-value":1,"unchecked-value":2,onChange:c=>ve({id:`${t.id}`,status:Number(`${t.status}`)})},null,8,["modelValue","onUpdate:modelValue","onChange"])]),operations:l(({record:t})=>[a(y,{type:"text",size:"small",onClick:c=>Ve(t.id)},{default:l(()=>[i(d(e.$t("key.columns.operations.view")),1)]),_:2},1032,["onClick"]),a(y,{type:"text",size:"small",onClick:c=>e.$router.push({name:"KeyUpdate",query:{id:`${t.id}`}})},{default:l(()=>[i(d(e.$t("key.columns.operations.update")),1)]),_:2},1032,["onClick"]),a(Me,{content:"\u4F60\u786E\u5B9A\u8981\u5220\u9664\u5417?",onOk:c=>ce({id:`${t.id}`})},{default:l(()=>[a(y,{type:"text",size:"small"},{default:l(()=>[i(d(e.$t("key.columns.operations.delete")),1)]),_:1})]),_:2},1032,["onOk"])]),_:1},8,["loading","pagination","columns","data","size","row-selection"]),a(Pe,{title:e.$t("menu.key.detail"),"unmount-on-close":"","render-to-body":"",width:700,footer:!1,visible:M.value,onCancel:Fe},{default:l(()=>[a(Kt,{id:B.value},null,8,["id"])]),_:1},8,["title","visible"]),a(Oe,{visible:K.value,"onUpdate:visible":o[10]||(o[10]=t=>K.value=t),title:"\u6A21\u578B","modal-style":{padding:"25px 15px 20px 15px"},"unmount-on-close":"","hide-cancel":"",simple:"",width:"920px","ok-text":"\u5173\u95ED"},{default:l(()=>[a(Mt,{id:B.value,action:ae.value},null,8,["id","action"])]),_:1},8,["visible"])]),_:1})])}}});const qa=We(Wt,[["__scopeId","data-v-304ff03a"]]);export{qa as default};
