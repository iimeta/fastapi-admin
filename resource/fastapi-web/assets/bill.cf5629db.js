import{u as re,F as Ne,q as Pe,z as Re,j as qe,A as He,_ as Oe}from"./index.0a66d3a0.js";/* empty css               *//* empty css               *//* empty css              *//* empty css               *//* empty css               *//* empty css               *//* empty css               *//* empty css               *//* empty css               *//* empty css               *//* empty css               *//* empty css                *//* empty css              *//* empty css              *//* empty css              */import{d as ce,e as r,B as o,C as g,aH as e,aG as t,u,aD as S,aM as m,aL as C,bA as Te,bB as je,bC as Me,bE as Ge,bZ as Je,bO as de,r as ne,c as oe,w as Qe,bF as Ke,bu as O,D as w,aJ as se,aI as ie,E as We,n as Ze,aK as Xe,aF as Ye,aS as et,b2 as tt,bG as at,bJ as lt,bK as nt,b5 as ot,bL as st,ab as it,aU as rt,bi as ct,bj as dt,bl as ut,bm as _t,b4 as mt,bM as pt,aV as ft,a_ as bt,bU as vt,g as gt}from"./arco.088e2a49.js";import{u as ue}from"./loading.6f488126.js";import{c as T,S as ht}from"./sortable.esm.70bb3f9a.js";import{q as yt,a as kt,s as xt}from"./finance.04736afe.js";import{Q as j}from"./quota.da4d358d.js";/* empty css                *//* empty css                */import"./chart.0bfa65d3.js";import"./vue.bd25b247.js";import"./common.051a2527.js";const wt={style:{margin:"10px 0 30px 10px"}},Ct={key:1},St={key:1},Bt={key:1},$t={key:1},Dt={name:"BillDetail"},It=ce({...Dt,props:{id:{type:String,default:""}},setup(M){const L=M,{t:_}=re(),{loading:s,setLoading:F}=ue(!0),h=r({});return(async(p={id:L.id})=>{F(!0);try{const{data:f}=await yt(p);h.value=f}catch{}finally{F(!1)}})(),(p,f)=>{const v=Te,y=je,k=Me,D=Ge,I=Je,x=de;return o(),g("div",wt,[e(D,{column:2,bordered:"","value-style":{width:"350px",padding:"5px 8px 5px 20px"}},{default:t(()=>[e(k,{label:u(_)("bill.detail.label.stat_date")},{default:t(()=>[u(s)?(o(),S(y,{key:0,animation:!0},{default:t(()=>[e(v,{rows:1})]),_:1})):(o(),g("span",Ct,m(h.value.stat_date||"-"),1))]),_:1},8,["label"]),e(k,{label:u(_)("bill.detail.label.user_id")},{default:t(()=>[u(s)?(o(),S(y,{key:0,animation:!0},{default:t(()=>[e(v,{rows:1})]),_:1})):(o(),g("span",St,m(h.value.user_id||"-"),1))]),_:1},8,["label"]),e(k,{label:u(_)("bill.detail.label.total")},{default:t(()=>[u(s)?(o(),S(y,{key:0,animation:!0},{default:t(()=>[e(v,{rows:1})]),_:1})):(o(),g("span",Bt,m(h.value.total.toLocaleString()),1))]),_:1},8,["label"]),e(k,{label:u(_)("bill.detail.label.tokens")},{default:t(()=>[u(s)?(o(),S(y,{key:0,animation:!0},{default:t(()=>[e(v,{rows:1})]),_:1})):(o(),g("span",$t,[e(j,{"model-value":h.value.tokens},null,8,["model-value"])]))]),_:1},8,["label"])]),_:1}),e(x,{style:{"margin-top":"15px"},data:h.value.model_stats,pagination:!1,bordered:!1},{columns:t(()=>[e(I,{title:u(_)("bill.detail.label.model"),"data-index":"model",align:"center"},{cell:t(({record:b})=>[C(m(b.model||"-"),1)]),_:1},8,["title"]),e(I,{title:u(_)("bill.detail.label.total"),"data-index":"total",align:"center"},{cell:t(({record:b})=>[C(m(b.total.toLocaleString()),1)]),_:1},8,["title"]),e(I,{title:u(_)("bill.detail.label.tokens"),"data-index":"tokens",align:"center"},{cell:t(({record:b})=>[e(j,{"model-value":b.tokens},null,8,["model-value"])]),_:1},8,["title"])]),_:1},8,["data"])])}}}),Vt={class:"container"},Ft={class:"action-icon"},zt={class:"action-icon"},Et={id:"tableSetting"},Lt={style:{"margin-right":"4px",cursor:"move"}},At={class:"title"},Ut={name:"BillList"},Nt=ce({...Ut,setup(M){const{loading:L,setLoading:_}=ue(!0),{t:s}=re(),F=ne({type:"checkbox",showCheckedAll:!0,onlyCurrent:!1}),h=()=>({user_id:r(),stat_date:[]}),A=r([]),p=r(h()),f=r([]),v=r([]),y=r("medium"),k=r(),D=r([]),I=r(!0),x={current:1,pageSize:20,showTotal:!0,showPageSize:!0,pageSizeOptions:[20,50,100,500,1e3]},b=ne({...x}),_e=oe(()=>[{name:s("size.mini"),value:"mini"},{name:s("size.small"),value:"small"},{name:s("size.medium"),value:"medium"},{name:s("size.large"),value:"large"}]),me=oe(()=>[{title:s("finance.columns.user_id"),dataIndex:"user_id",slotName:"user_id",align:"center",width:80},{title:s("finance.columns.total"),dataIndex:"total",slotName:"total",align:"center"},{title:s("finance.columns.models"),dataIndex:"models",slotName:"models",align:"center"},{title:s("finance.columns.tokens"),dataIndex:"tokens",slotName:"tokens",align:"center"},{title:s("finance.columns.stat_date"),dataIndex:"stat_date",slotName:"stat_date",align:"center"},{title:s("common.operations"),dataIndex:"operations",slotName:"operations",align:"center",width:75}]),z=async(a={...x})=>{_(!0);try{const{data:l}=await kt(a);A.value=l.items,b.current=a.current,b.pageSize=a.pageSize,b.total=l.paging.total}catch{}finally{_(!1),k.value.selectAll(!1)}};z();const G=()=>{z({...x,...p.value})},pe=a=>{z({...x,...p.value,current:a})},fe=a=>{x.pageSize=a,z({...x,...p.value})},be=(a,l)=>{y.value=a},ve=(a,l,c)=>{a?f.value.splice(c,0,l):f.value=v.value.filter(d=>d.dataIndex!==l.dataIndex)},J=(a,l,c,d=!1)=>{const i=d?T(a):a;return l>-1&&c>-1&&i.splice(l,1,i.splice(c,1,i[l]).pop()),i},ge=a=>{a&&Ze(()=>{const l=document.getElementById("tableSetting");new ht(l,{onEnd(c){const{oldIndex:d,newIndex:i}=c;J(f.value,d,i),J(v.value,d,i)}})})};Qe(()=>me.value,a=>{f.value=T(a),f.value.forEach((l,c)=>{l.checked=!0}),v.value=T(f.value)},{deep:!0,immediate:!0});const{proxy:Q}=gt(),he=a=>{D.value=a,I.value=!a.length},K=r(),V=r(!1),B=r({}),ye=async a=>{var c;if(await((c=K.value)==null?void 0:c.validate())){V.value=!0,a(!1);return}a(),W(B.value)},ke=()=>{V.value=!1},W=a=>{if(D.value.length===0&&!a.stat_date){V.value=!0;return}_(!0),a.ids=D.value,xt(a).then(l=>{_(!1),Q.$message.success("\u5BFC\u51FA\u6210\u529F"),k.value.selectAll(!1);const c=new Blob([l.data],{type:"application/vnd.ms-excel"}),d=window.URL.createObjectURL(c),i=document.createElement("a");i.href=d,i.setAttribute("download","\u8D26\u5355\u660E\u7EC6.xlsx"),document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(d)}).catch(l=>{Q.$message.error("\u5BFC\u51FA\u5931\u8D25, \u8BF7\u8054\u7CFB\u7BA1\u7406\u5458",l)})},U=r(!1),Z=r(),xe=a=>{U.value=!0,Z.value=a},we=()=>{U.value=!1};return(a,l)=>{const c=Ne,d=Xe,i=Ye,X=et,E=tt,$=at,Y=lt,N=nt,ee=ot,te=st,Ce=it,P=rt,ae=ct,Se=Pe,R=dt,Be=Re,$e=ut,De=_t,Ie=qe,Ve=He,Fe=mt,ze=pt,Ee=de,Le=ft,Ae=bt,Ue=vt,q=Ke("permission");return o(),g("div",Vt,[e(i,{class:"container-breadcrumb"},{default:t(()=>[e(d,null,{default:t(()=>[e(c)]),_:1}),e(d,null,{default:t(()=>[C(m(a.$t("menu.finance")),1)]),_:1}),e(d,null,{default:t(()=>[C(m(a.$t("menu.bill.list")),1)]),_:1})]),_:1}),e(Ue,{class:"general-card",bordered:!1,"header-style":{padding:"20px"},"body-style":{padding:"25px 20px 20px 20px"}},{default:t(()=>[O((o(),S(N,null,{default:t(()=>[e($,{flex:1},{default:t(()=>[e(ee,{model:p.value,"label-col-props":{span:5},"wrapper-col-props":{span:18},"label-align":"left"},{default:t(()=>[e(N,{gutter:16},{default:t(()=>[e($,{span:8},{default:t(()=>[e(E,{field:"name",label:a.$t("finance.form.user_id")},{default:t(()=>[e(X,{modelValue:p.value.user_id,"onUpdate:modelValue":l[0]||(l[0]=n=>p.value.user_id=n),placeholder:a.$t("finance.form.user_id.placeholder"),precision:0,min:1,"allow-clear":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),e($,{span:8},{default:t(()=>[e(E,{field:"stat_date",label:a.$t("finance.form.stat_date")},{default:t(()=>[e(Y,{modelValue:p.value.stat_date,"onUpdate:modelValue":l[1]||(l[1]=n=>p.value.stat_date=n),style:{width:"100%"}},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(te,{style:{height:"32px"},direction:"vertical"}),e($,{flex:"86px",style:{"text-align":"right"}},{default:t(()=>[e(ae,{direction:"vertical",size:18},{default:t(()=>[e(P,{type:"primary",onClick:G},{icon:t(()=>[e(Ce)]),default:t(()=>[C(" "+m(a.$t("finance.form.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})),[[q,["reseller","admin"]]]),O(e(te,{style:{"margin-top":"0","margin-bottom":"16px"}},null,512),[[q,["reseller","admin"]]]),e(N,{style:{"margin-bottom":"16px"}},{default:t(()=>[e($,{span:12},{default:t(()=>[e(ae,null,{default:t(()=>[e(P,{type:"primary",onClick:l[2]||(l[2]=n=>W({}))},{default:t(()=>[C(" \u5BFC\u51FA ")]),_:1})]),_:1})]),_:1}),e($,{span:12,style:{display:"flex",height:"32px","align-items":"center","justify-content":"end"}},{default:t(()=>[e(R,{content:a.$t("actions.refresh")},{default:t(()=>[w("div",{class:"action-icon",onClick:G},[e(Se,{size:"18"})])]),_:1},8,["content"]),e(De,{onSelect:be},{content:t(()=>[(o(!0),g(se,null,ie(u(_e),n=>(o(),S($e,{key:n.value,value:n.value,class:We({active:n.value===y.value})},{default:t(()=>[w("span",null,m(n.name),1)]),_:2},1032,["value","class"]))),128))]),default:t(()=>[e(R,{content:a.$t("actions.density")},{default:t(()=>[w("div",Ft,[e(Be,{size:"18"})])]),_:1},8,["content"])]),_:1}),e(R,{content:a.$t("actions.column_setting")},{default:t(()=>[e(ze,{trigger:"click",position:"bl",onPopupVisibleChange:ge},{content:t(()=>[w("div",Et,[(o(!0),g(se,null,ie(v.value,(n,le)=>(o(),g("div",{key:n.dataIndex,class:"setting"},[w("div",Lt,[e(Ve)]),w("div",null,[e(Fe,{modelValue:n.checked,"onUpdate:modelValue":H=>n.checked=H,onChange:H=>ve(H,n,le)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),w("div",At,m(n.title==="#"?"\u5E8F\u5217\u53F7":n.title),1)]))),128))])]),default:t(()=>[w("div",zt,[e(Ie,{size:"18"})])]),_:1})]),_:1},8,["content"])]),_:1})]),_:1}),e(Ee,{ref_key:"tableRef",ref:k,"row-key":"id",loading:u(L),pagination:b,columns:f.value,data:A.value,bordered:!1,size:y.value,"row-selection":F,onPageChange:pe,onPageSizeChange:fe,onSelectionChange:he},{total:t(({record:n})=>[C(m(n.total.toLocaleString()),1)]),tokens:t(({record:n})=>[e(j,{"model-value":n.tokens},null,8,["model-value"])]),operations:t(({record:n})=>[e(P,{type:"text",size:"small",onClick:le=>xe(n.id)},{default:t(()=>[C(m(a.$t("operations.view")),1)]),_:2},1032,["onClick"])]),_:1},8,["loading","pagination","columns","data","size","row-selection"]),e(Le,{title:a.$t("menu.bill.detail"),"unmount-on-close":"","render-to-body":"",width:700,footer:!1,visible:U.value,onCancel:we},{default:t(()=>[e(It,{id:Z.value},null,8,["id"])]),_:1},8,["title","visible"]),e(Ae,{visible:V.value,"onUpdate:visible":l[5]||(l[5]=n=>V.value=n),title:a.$t("finance.form.title.bill_export"),onCancel:ke,onBeforeOk:ye},{default:t(()=>[e(ee,{ref_key:"billExportForm",ref:K,model:B.value},{default:t(()=>[e(E,{field:"stat_date",label:a.$t("finance.form.stat_date"),rules:[{required:!0,message:a.$t("finance.error.stat_date.required")}]},{default:t(()=>[e(Y,{modelValue:B.value.stat_date,"onUpdate:modelValue":l[3]||(l[3]=n=>B.value.stat_date=n),style:{width:"100%"}},null,8,["modelValue"])]),_:1},8,["label","rules"]),O((o(),S(E,{field:"user_id",label:a.$t("finance.form.user_id")},{default:t(()=>[e(X,{modelValue:B.value.user_id,"onUpdate:modelValue":l[4]||(l[4]=n=>B.value.user_id=n),placeholder:a.$t("finance.form.user_id.placeholder"),precision:0,min:1,"allow-clear":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"])),[[q,["reseller","admin"]]])]),_:1},8,["model"])]),_:1},8,["visible","title"])]),_:1})])}}});const da=Oe(Nt,[["__scopeId","data-v-855ca10d"]]);export{da as default};
