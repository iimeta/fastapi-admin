import{u as ie,G as Ue,s as Ne,A as Pe,k as Re,B as He,_ as Te}from"./index.780491c6.js";/* empty css               *//* empty css               *//* empty css              *//* empty css               *//* empty css               *//* empty css               *//* empty css               *//* empty css               *//* empty css               *//* empty css               *//* empty css               *//* empty css                *//* empty css              *//* empty css              *//* empty css              */import{d as re,e as r,B as o,C as y,aH as e,aG as t,u as _,aD as $,aM as c,aL as v,bA as qe,bB as Oe,bC as je,bE as Me,bZ as Ge,bM as ce,r as le,c as ne,w as Je,bS as Ke,bn as q,D as C,aJ as oe,aI as se,E as We,n as Ze,aK as Qe,aF as Xe,aS as Ye,b2 as et,bH as tt,bT as at,bI as lt,b5 as nt,bJ as ot,ab as st,aU as it,bi as rt,bj as ct,bk as dt,bl as ut,b4 as _t,bK as pt,aV as mt,a_ as ft,bN as bt,g as vt}from"./arco.cbac690a.js";import{u as de}from"./loading.b56ef223.js";import{q as gt,a as ht,s as yt}from"./finance.1fb33483.js";import{c as O,S as kt}from"./sortable.esm.59243d4c.js";/* empty css                *//* empty css                */import"./chart.e521dee8.js";import"./vue.4014b72a.js";const xt={style:{margin:"10px 0 30px 10px"}},wt={key:1},Ct={key:1},$t={key:1},St={key:1},Bt={name:"BillDetail"},Dt=re({...Bt,props:{id:{type:String,default:""}},setup(j){const L=j,{t:p}=ie(),{loading:s,setLoading:z}=de(!0),g=r({});return(async(m={id:L.id})=>{z(!0);try{const{data:f}=await gt(m);g.value=f}catch{}finally{z(!1)}})(),(m,f)=>{const h=qe,k=Oe,x=je,D=Me,I=Ge,w=ce;return o(),y("div",xt,[e(D,{column:2,bordered:"","value-style":{width:"350px",padding:"5px 8px 5px 20px"}},{default:t(()=>[e(x,{label:_(p)("bill.detail.label.stat_date")},{default:t(()=>[_(s)?(o(),$(k,{key:0,animation:!0},{default:t(()=>[e(h,{rows:1})]),_:1})):(o(),y("span",wt,c(g.value.stat_date||"-"),1))]),_:1},8,["label"]),e(x,{label:_(p)("bill.detail.label.user_id")},{default:t(()=>[_(s)?(o(),$(k,{key:0,animation:!0},{default:t(()=>[e(h,{rows:1})]),_:1})):(o(),y("span",Ct,c(g.value.user_id||"-"),1))]),_:1},8,["label"]),e(x,{label:_(p)("bill.detail.label.total")},{default:t(()=>[_(s)?(o(),$(k,{key:0,animation:!0},{default:t(()=>[e(h,{rows:1})]),_:1})):(o(),y("span",$t,c(g.value.total.toLocaleString()),1))]),_:1},8,["label"]),e(x,{label:_(p)("bill.detail.label.tokens")},{default:t(()=>[_(s)?(o(),$(k,{key:0,animation:!0},{default:t(()=>[e(h,{rows:1})]),_:1})):(o(),y("span",St,c(g.value.tokens>0?`$${g.value.tokens}`:"$0.00"),1))]),_:1},8,["label"])]),_:1}),e(w,{style:{"margin-top":"15px"},data:g.value.model_stats,pagination:!1,bordered:!1},{columns:t(()=>[e(I,{title:_(p)("bill.detail.label.model"),"data-index":"model",align:"center"},{cell:t(({record:b})=>[v(c(b.model||"-"),1)]),_:1},8,["title"]),e(I,{title:_(p)("bill.detail.label.total"),"data-index":"total",align:"center"},{cell:t(({record:b})=>[v(c(b.total.toLocaleString()),1)]),_:1},8,["title"]),e(I,{title:_(p)("bill.detail.label.tokens"),"data-index":"tokens",align:"center"},{cell:t(({record:b})=>[v(c(b.tokens>0?`$${b.tokens}`:"$0.00"),1)]),_:1},8,["title"])]),_:1},8,["data"])])}}}),It={class:"container"},Vt={class:"action-icon"},zt={class:"action-icon"},Ft={id:"tableSetting"},Et={style:{"margin-right":"4px",cursor:"move"}},Lt={class:"title"},At={name:"BillList"},Ut=re({...At,setup(j){const{loading:L,setLoading:p}=de(!0),{t:s}=ie(),z=le({type:"checkbox",showCheckedAll:!0,onlyCurrent:!1}),g=()=>({user_id:r(),stat_date:[]}),A=r([]),m=r(g()),f=r([]),h=r([]),k=r("medium"),x=r(),D=r([]),I=r(!0),w={current:1,pageSize:20,showTotal:!0,showPageSize:!0,pageSizeOptions:[20,50,100,500,1e3]},b=le({...w}),ue=ne(()=>[{name:s("size.mini"),value:"mini"},{name:s("size.small"),value:"small"},{name:s("size.medium"),value:"medium"},{name:s("size.large"),value:"large"}]),_e=ne(()=>[{title:s("finance.columns.user_id"),dataIndex:"user_id",slotName:"user_id",align:"center",width:80},{title:s("finance.columns.total"),dataIndex:"total",slotName:"total",align:"center"},{title:s("finance.columns.models"),dataIndex:"models",slotName:"models",align:"center"},{title:s("finance.columns.tokens"),dataIndex:"tokens",slotName:"tokens",align:"center"},{title:s("finance.columns.stat_date"),dataIndex:"stat_date",slotName:"stat_date",align:"center"},{title:s("common.operations"),dataIndex:"operations",slotName:"operations",align:"center",width:75}]),F=async(a={...w})=>{p(!0);try{const{data:l}=await ht(a);A.value=l.items,b.current=a.current,b.pageSize=a.pageSize,b.total=l.paging.total}catch{}finally{p(!1),x.value.selectAll(!1)}};F();const M=()=>{F({...w,...m.value})},pe=a=>{F({...w,...m.value,current:a})},me=a=>{w.pageSize=a,F({...w,...m.value})},fe=(a,l)=>{k.value=a},be=(a,l,d)=>{a?f.value.splice(d,0,l):f.value=h.value.filter(u=>u.dataIndex!==l.dataIndex)},G=(a,l,d,u=!1)=>{const i=u?O(a):a;return l>-1&&d>-1&&i.splice(l,1,i.splice(d,1,i[l]).pop()),i},ve=a=>{a&&Ze(()=>{const l=document.getElementById("tableSetting");new kt(l,{onEnd(d){const{oldIndex:u,newIndex:i}=d;G(f.value,u,i),G(h.value,u,i)}})})};Je(()=>_e.value,a=>{f.value=O(a),f.value.forEach((l,d)=>{l.checked=!0}),h.value=O(f.value)},{deep:!0,immediate:!0});const{proxy:J}=vt(),ge=a=>{D.value=a,I.value=!a.length},K=r(),V=r(!1),S=r({}),he=async a=>{var d;if(await((d=K.value)==null?void 0:d.validate())){V.value=!0,a(!1);return}a(),W(S.value)},ye=()=>{V.value=!1},W=a=>{if(D.value.length===0&&!a.stat_date){V.value=!0;return}p(!0),a.ids=D.value,yt(a).then(l=>{p(!1),J.$message.success("\u5BFC\u51FA\u6210\u529F"),x.value.selectAll(!1);const d=new Blob([l.data],{type:"application/vnd.ms-excel"}),u=window.URL.createObjectURL(d),i=document.createElement("a");i.href=u,i.setAttribute("download","\u8D26\u5355\u660E\u7EC6.xlsx"),document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(u)}).catch(l=>{J.$message.error("\u5BFC\u51FA\u5931\u8D25, \u8BF7\u8054\u7CFB\u7BA1\u7406\u5458",l)})},U=r(!1),Z=r(),ke=a=>{U.value=!0,Z.value=a},xe=()=>{U.value=!1};return(a,l)=>{const d=Ue,u=Qe,i=Xe,Q=Ye,E=et,B=tt,X=at,N=lt,Y=nt,ee=ot,we=st,P=it,te=rt,Ce=Ne,R=ct,$e=Pe,Se=dt,Be=ut,De=Re,Ie=He,Ve=_t,ze=pt,Fe=ce,Ee=mt,Le=ft,Ae=bt,H=Ke("permission");return o(),y("div",It,[e(i,{class:"container-breadcrumb"},{default:t(()=>[e(u,null,{default:t(()=>[e(d)]),_:1}),e(u,null,{default:t(()=>[v(c(a.$t("menu.finance")),1)]),_:1}),e(u,null,{default:t(()=>[v(c(a.$t("menu.bill.list")),1)]),_:1})]),_:1}),e(Ae,{class:"general-card",bordered:!1,"header-style":{padding:"20px"},"body-style":{padding:"25px 20px 20px 20px"}},{default:t(()=>[q((o(),$(N,null,{default:t(()=>[e(B,{flex:1},{default:t(()=>[e(Y,{model:m.value,"label-col-props":{span:5},"wrapper-col-props":{span:18},"label-align":"left"},{default:t(()=>[e(N,{gutter:16},{default:t(()=>[e(B,{span:8},{default:t(()=>[e(E,{field:"name",label:a.$t("finance.form.user_id")},{default:t(()=>[e(Q,{modelValue:m.value.user_id,"onUpdate:modelValue":l[0]||(l[0]=n=>m.value.user_id=n),placeholder:a.$t("finance.form.user_id.placeholder"),precision:0,min:1,"allow-clear":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),e(B,{span:8},{default:t(()=>[e(E,{field:"stat_date",label:a.$t("finance.form.stat_date")},{default:t(()=>[e(X,{modelValue:m.value.stat_date,"onUpdate:modelValue":l[1]||(l[1]=n=>m.value.stat_date=n),style:{width:"100%"}},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(ee,{style:{height:"32px"},direction:"vertical"}),e(B,{flex:"86px",style:{"text-align":"right"}},{default:t(()=>[e(te,{direction:"vertical",size:18},{default:t(()=>[e(P,{type:"primary",onClick:M},{icon:t(()=>[e(we)]),default:t(()=>[v(" "+c(a.$t("finance.form.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})),[[H,["reseller","admin"]]]),q(e(ee,{style:{"margin-top":"0","margin-bottom":"16px"}},null,512),[[H,["reseller","admin"]]]),e(N,{style:{"margin-bottom":"16px"}},{default:t(()=>[e(B,{span:12},{default:t(()=>[e(te,null,{default:t(()=>[e(P,{type:"primary",onClick:l[2]||(l[2]=n=>W({}))},{default:t(()=>[v(" \u5BFC\u51FA ")]),_:1})]),_:1})]),_:1}),e(B,{span:12,style:{display:"flex",height:"32px","align-items":"center","justify-content":"end"}},{default:t(()=>[e(R,{content:a.$t("actions.refresh")},{default:t(()=>[C("div",{class:"action-icon",onClick:M},[e(Ce,{size:"18"})])]),_:1},8,["content"]),e(Be,{onSelect:fe},{content:t(()=>[(o(!0),y(oe,null,se(_(ue),n=>(o(),$(Se,{key:n.value,value:n.value,class:We({active:n.value===k.value})},{default:t(()=>[C("span",null,c(n.name),1)]),_:2},1032,["value","class"]))),128))]),default:t(()=>[e(R,{content:a.$t("actions.density")},{default:t(()=>[C("div",Vt,[e($e,{size:"18"})])]),_:1},8,["content"])]),_:1}),e(R,{content:a.$t("actions.column_setting")},{default:t(()=>[e(ze,{trigger:"click",position:"bl",onPopupVisibleChange:ve},{content:t(()=>[C("div",Ft,[(o(!0),y(oe,null,se(h.value,(n,ae)=>(o(),y("div",{key:n.dataIndex,class:"setting"},[C("div",Et,[e(Ie)]),C("div",null,[e(Ve,{modelValue:n.checked,"onUpdate:modelValue":T=>n.checked=T,onChange:T=>be(T,n,ae)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),C("div",Lt,c(n.title==="#"?"\u5E8F\u5217\u53F7":n.title),1)]))),128))])]),default:t(()=>[C("div",zt,[e(De,{size:"18"})])]),_:1})]),_:1},8,["content"])]),_:1})]),_:1}),e(Fe,{ref_key:"tableRef",ref:x,"row-key":"id",loading:_(L),pagination:b,columns:f.value,data:A.value,bordered:!1,size:k.value,"row-selection":z,onPageChange:pe,onPageSizeChange:me,onSelectionChange:ge},{total:t(({record:n})=>[v(c(n.total.toLocaleString()),1)]),tokens:t(({record:n})=>[v(c(n.tokens>0?`$${n.tokens}`:"$0.00"),1)]),operations:t(({record:n})=>[e(P,{type:"text",size:"small",onClick:ae=>ke(n.id)},{default:t(()=>[v(c(a.$t("operations.view")),1)]),_:2},1032,["onClick"])]),_:1},8,["loading","pagination","columns","data","size","row-selection"]),e(Ee,{title:a.$t("menu.bill.detail"),"unmount-on-close":"","render-to-body":"",width:700,footer:!1,visible:U.value,onCancel:xe},{default:t(()=>[e(Dt,{id:Z.value},null,8,["id"])]),_:1},8,["title","visible"]),e(Le,{visible:V.value,"onUpdate:visible":l[5]||(l[5]=n=>V.value=n),title:a.$t("finance.form.title.bill_export"),onCancel:ye,onBeforeOk:he},{default:t(()=>[e(Y,{ref_key:"billExportForm",ref:K,model:S.value},{default:t(()=>[e(E,{field:"stat_date",label:a.$t("finance.form.stat_date"),rules:[{required:!0,message:a.$t("finance.error.stat_date.required")}]},{default:t(()=>[e(X,{modelValue:S.value.stat_date,"onUpdate:modelValue":l[3]||(l[3]=n=>S.value.stat_date=n),style:{width:"100%"}},null,8,["modelValue"])]),_:1},8,["label","rules"]),q((o(),$(E,{field:"user_id",label:a.$t("finance.form.user_id")},{default:t(()=>[e(Q,{modelValue:S.value.user_id,"onUpdate:modelValue":l[4]||(l[4]=n=>S.value.user_id=n),placeholder:a.$t("finance.form.user_id.placeholder"),precision:0,min:1,"allow-clear":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"])),[[H,["reseller","admin"]]])]),_:1},8,["model"])]),_:1},8,["visible","title"])]),_:1})])}}});const ia=Te(Ut,[["__scopeId","data-v-83f10923"]]);export{ia as default};
