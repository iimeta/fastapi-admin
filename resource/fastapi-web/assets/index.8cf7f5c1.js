import{H as ue,_ as te}from"./index.780491c6.js";/* empty css               *//* empty css              *//* empty css               *//* empty css              *//* empty css              *//* empty css               *//* empty css               *//* empty css              *//* empty css               *//* empty css               *//* empty css                *//* empty css               *//* empty css                */import{d as de,e as p,B as s,C as y,aH as a,aG as r,aL as d,aM as h,D as N,aD as i,aE as f,aJ as C,aI as F,u as _,bn as se,bo as ne,aK as ie,aF as fe,bJ as _e,b1 as me,b2 as pe,aS as ge,bP as ce,aT as ve,bO as we,bQ as be,bi as ye,bF as he,bG as Ve,bU as $e,b4 as ke,a5 as qe,aU as Ue,a4 as De,bV as Ce,b5 as Fe,bN as Be,bR as Le,g as Ge}from"./arco.cbac690a.js";import{u as Ie}from"./loading.b56ef223.js";import{d as w}from"./dayjs.min.4477b2e6.js";import{h as Me,f as Se}from"./vue.4014b72a.js";import{p as T,d as He}from"./common.5976a1f1.js";import{h as Ae,a as Ee}from"./group.6a51724a.js";import{q as Re,b as Ne}from"./model.3da89a35.js";import{f as Te}from"./agent.228f96b5.js";import"./chart.e521dee8.js";const Qe={class:"container"},Pe={class:"wrapper"},Ke={class:"submit-btn"},ze={name:"GroupUpdate"},Je=de({...ze,setup(Oe){const{loading:Q,setLoading:m}=Ie(!1),{proxy:P}=Ge(),K=Me(),z=Se(),B=p([]);(async()=>{m(!0);try{const{data:l}=await Re();B.value=l.items}catch{}finally{m(!1)}})();const M=p([]);(async()=>{m(!0);try{const{data:l}=await Ne();M.value=l.items}catch{}finally{m(!1)}})();const S=p([]);(async()=>{m(!0);try{const{data:l}=await Te();S.value=l.items}catch{}finally{m(!1)}})();const H=p(),e=p({name:"",discount:p(),models:[],is_default:!1,is_public:!0,weight:p(),expires_at:"",remark:"",status:1,is_enable_model_agent:!1,lb_strategy:"1",model_agents:[],is_limit_quota:!1,quota:p(),is_enable_forward:!1,forward_config:{forward_rule:"1",match_rule:["2"],target_model:"",decision_model:"",keywords:[],target_models:[],content_length:p(),used_quota:p()}}),J=async()=>{var t;if(!await((t=H.value)==null?void 0:t.validate())){m(!0);try{await Ae(e.value).then(()=>{P.$message.success("\u66F4\u65B0\u6210\u529F"),z.push({name:"GroupList"})})}catch{}finally{m(!1)}}};(async(l={id:K.query.id})=>{var t,V,b,L,$,k;m(!0);try{const{data:u}=await Ee(l);e.value.id=u.id,e.value.name=u.name,e.value.discount=Number((u.discount*100).toFixed(2)),e.value.models=u.models,e.value.is_default=u.is_default||!1,e.value.is_public=u.is_public||!1,e.value.weight=u.weight,e.value.expires_at=u.expires_at,e.value.remark=u.remark,e.value.status=u.status,e.value.is_enable_model_agent=u.is_enable_model_agent,e.value.lb_strategy=String(u.lb_strategy),e.value.model_agents=u.model_agents,e.value.is_limit_quota=u.is_limit_quota,e.value.quota=u.quota,e.value.is_enable_forward=u.is_enable_forward,e.value.forward_config=u.forward_config,u.forward_config&&(u.forward_config.forward_rule&&(e.value.forward_config.forward_rule=String(u.forward_config.forward_rule)),u.forward_config.match_rule&&(e.value.forward_config.match_rule=u.forward_config.match_rule.map(String)),e.value.forward_config.content_length=(t=u.forward_config)==null?void 0:t.content_length,e.value.forward_config.target_model=(V=u.forward_config)==null?void 0:V.target_model,e.value.forward_config.decision_model=(b=u.forward_config)==null?void 0:b.decision_model,e.value.forward_config.keywords=(L=u.forward_config)==null?void 0:L.keywords,e.value.forward_config.target_models=($=u.forward_config)==null?void 0:$.target_models,e.value.forward_config.used_quota=(k=u.forward_config)==null?void 0:k.used_quota)}catch{}finally{m(!1)}})();const O=l=>{e.value.quota=l},j=l=>{e.value.forward_config.used_quota=l},A=()=>{!e.value.is_enable_forward&&e.value.forward_config.keywords&&(e.value.forward_config.keywords[0]===""||e.value.forward_config.target_models[0]==="")?(e.value.forward_config.keywords=[],e.value.forward_config.target_models=[]):e.value.forward_config.forward_rule==="2"&&(!e.value.forward_config.keywords||e.value.forward_config.keywords.length===0)?(e.value.forward_config.keywords=[""],e.value.forward_config.target_models=[""]):(e.value.forward_config.forward_rule==="1"||e.value.forward_config.forward_rule==="3"||e.value.forward_config.forward_rule==="4")&&e.value.forward_config.keywords&&(e.value.forward_config.keywords[0]===""||e.value.forward_config.target_models[0]==="")&&(e.value.forward_config.keywords=[],e.value.forward_config.target_models=[])},W=()=>{e.value.forward_config.keywords.push(""),e.value.forward_config.target_models.push("")},X=l=>{e.value.forward_config.keywords.length>1&&(e.value.forward_config.keywords.splice(l,1),e.value.forward_config.target_models.splice(l,1))};return(l,t)=>{const V=ue,b=ie,L=fe,$=_e,k=me,u=pe,q=ge,Y=ce,U=ve,Z=we,n=be,I=ye,c=he,D=Ve,E=$e,R=ke,x=qe,G=Ue,ee=De,le=Ce,ae=Fe,re=Be,oe=Le;return s(),y("div",Qe,[a(L,{class:"container-breadcrumb"},{default:r(()=>[a(b,null,{default:r(()=>[a(V)]),_:1}),a(b,null,{default:r(()=>[d(h(l.$t("menu.group")),1)]),_:1}),a(b,null,{default:r(()=>[d(h(l.$t("menu.group.update")),1)]),_:1})]),_:1}),a(oe,{loading:_(Q),style:{width:"100%"}},{default:r(()=>[a(re,{class:"general-card","body-style":{padding:"0 20px 20px 20px"},bordered:!1},{default:r(()=>[N("div",Pe,[a(ae,{ref_key:"formRef",ref:H,model:e.value,class:"form","label-col-props":{span:3},"wrapper-col-props":{span:21}},{default:r(()=>[a($,{orientation:"left"},{default:r(()=>[d(h(l.$t("common.title.baseInfo")),1)]),_:1}),a(u,{field:"name",label:l.$t("group.label.name"),rules:[{required:!0,message:l.$t("group.error.name.required")}]},{default:r(()=>[a(k,{modelValue:e.value.name,"onUpdate:modelValue":t[0]||(t[0]=o=>e.value.name=o),placeholder:l.$t("group.placeholder.name"),"allow-clear":""},null,8,["modelValue","placeholder"])]),_:1},8,["label","rules"]),a(u,{field:"discount",label:l.$t("group.label.discount"),rules:[{required:!0,message:l.$t("group.error.discount.required")}]},{default:r(()=>[a(q,{modelValue:e.value.discount,"onUpdate:modelValue":t[1]||(t[1]=o=>e.value.discount=o),placeholder:l.$t("group.placeholder.discount"),min:.01,max:9999999999999,"allow-clear":""},{append:r(()=>[d(" %")]),_:1},8,["modelValue","placeholder","min"])]),_:1},8,["label","rules"]),e.value.is_default?f("",!0):(s(),i(u,{key:0,field:"weight",label:l.$t("group.label.weight"),rules:[{required:!0,message:l.$t("group.error.weight.required")}]},{default:r(()=>[a(q,{modelValue:e.value.weight,"onUpdate:modelValue":t[2]||(t[2]=o=>e.value.weight=o),placeholder:l.$t("group.placeholder.weight"),precision:0,min:1,max:99999,"allow-clear":""},null,8,["modelValue","placeholder"])]),_:1},8,["label","rules"])),a(u,{field:"models",label:l.$t("group.label.models"),rules:[{required:!0,message:l.$t("group.error.models.required")}]},{default:r(()=>[a(Y,{modelValue:e.value.models,"onUpdate:modelValue":t[3]||(t[3]=o=>e.value.models=o),placeholder:l.$t("group.placeholder.models"),"allow-search":!0,"allow-clear":!0,"tree-checkable":!0,data:M.value,"max-tag-count":3,scrollbar:!1,"tree-checked-strategy":"child"},null,8,["modelValue","placeholder","data"])]),_:1},8,["label","rules"]),a(u,{field:"is_public",label:l.$t("group.label.is_public"),rules:[{required:!0}]},{default:r(()=>[a(U,{modelValue:e.value.is_public,"onUpdate:modelValue":t[4]||(t[4]=o=>e.value.is_public=o)},null,8,["modelValue"])]),_:1},8,["label"]),a(u,{field:"is_default",label:l.$t("group.label.is_default")},{default:r(()=>[a(U,{modelValue:e.value.is_default,"onUpdate:modelValue":t[5]||(t[5]=o=>e.value.is_default=o)},null,8,["modelValue"])]),_:1},8,["label"]),a(u,{field:"remark",label:l.$t("group.label.remark"),rules:[{required:!1}]},{default:r(()=>[a(Z,{modelValue:e.value.remark,"onUpdate:modelValue":t[6]||(t[6]=o=>e.value.remark=o),placeholder:l.$t("group.placeholder.remark")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a($,{orientation:"left"},{default:r(()=>[d(h(l.$t("common.title.advanced")),1)]),_:1}),a(u,{field:"is_enable_model_agent",label:l.$t("group.label.is_enable_model_agent")},{default:r(()=>[a(U,{modelValue:e.value.is_enable_model_agent,"onUpdate:modelValue":t[7]||(t[7]=o=>e.value.is_enable_model_agent=o)},null,8,["modelValue"])]),_:1},8,["label"]),e.value.is_enable_model_agent?(s(),i(u,{key:1,field:"lb_strategy",label:l.$t("model.label.lb_strategy"),rules:[{required:!0}]},{default:r(()=>[a(I,{size:"large"},{default:r(()=>[a(n,{modelValue:e.value.lb_strategy,"onUpdate:modelValue":t[8]||(t[8]=o=>e.value.lb_strategy=o),value:"1","default-checked":!0},{default:r(()=>[d(" \u8F6E\u8BE2 ")]),_:1},8,["modelValue"]),a(n,{modelValue:e.value.lb_strategy,"onUpdate:modelValue":t[9]||(t[9]=o=>e.value.lb_strategy=o),value:"2"},{default:r(()=>[d("\u6743\u91CD")]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["label"])):f("",!0),e.value.is_enable_model_agent?(s(),i(u,{key:2,field:"model_agents",label:l.$t("group.label.model_agents"),rules:[{required:!0,message:l.$t("group.error.model_agents.required")}]},{default:r(()=>[a(D,{modelValue:e.value.model_agents,"onUpdate:modelValue":t[10]||(t[10]=o=>e.value.model_agents=o),placeholder:l.$t("group.placeholder.model_agents"),"max-tag-count":3,scrollbar:!1,multiple:"","allow-search":"","allow-clear":""},{default:r(()=>[(s(!0),y(C,null,F(S.value,o=>(s(),i(c,{key:o.id,value:o.id,label:o.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label","rules"])):f("",!0),a(u,{field:"is_limit_quota",label:l.$t("group.label.is_limit_quota")},{default:r(()=>[a(U,{modelValue:e.value.is_limit_quota,"onUpdate:modelValue":t[11]||(t[11]=o=>e.value.is_limit_quota=o)},null,8,["modelValue"])]),_:1},8,["label"]),e.value.is_limit_quota?(s(),i(u,{key:3,field:"quota",label:l.$t("group.label.quota"),rules:[{required:!0,message:l.$t("group.error.quota.required")}]},{default:r(()=>[a(q,{modelValue:e.value.quota,"onUpdate:modelValue":t[12]||(t[12]=o=>e.value.quota=o),placeholder:l.$t("group.placeholder.quota"),min:1e-6,max:9999999999999,parser:_(T)},{prefix:r(()=>[d(" $ ")]),_:1},8,["modelValue","placeholder","min","parser"])]),_:1},8,["label","rules"])):f("",!0),e.value.is_limit_quota?(s(),i(u,{key:4},{default:r(()=>[a(E,{type:"button",onChange:O},{default:r(()=>[a(n,{value:100},{default:r(()=>[d(" $100 ")]),_:1}),a(n,{value:500},{default:r(()=>[d(" $500 ")]),_:1}),a(n,{value:1e3},{default:r(()=>[d(" $1,000 ")]),_:1}),a(n,{value:5e3},{default:r(()=>[d(" $5,000 ")]),_:1}),a(n,{value:1e4},{default:r(()=>[d(" $10,000 ")]),_:1}),a(n,{value:5e4},{default:r(()=>[d(" $50,000 ")]),_:1}),a(n,{value:1e5},{default:r(()=>[d(" $100,000 ")]),_:1}),a(n,{value:1e6},{default:r(()=>[d(" $1,000,000 ")]),_:1})]),_:1})]),_:1})):f("",!0),a(u,{field:"model_forward",label:l.$t("group.label.is_enable_forward")},{default:r(()=>[a(U,{modelValue:e.value.is_enable_forward,"onUpdate:modelValue":t[13]||(t[13]=o=>e.value.is_enable_forward=o),onChange:A},null,8,["modelValue"])]),_:1},8,["label"]),e.value.is_enable_forward?(s(),i(u,{key:5,field:"forward_config.forward_rule",label:l.$t("group.label.forward_rule"),rules:[{required:!0,message:l.$t("group.error.forward_rule.required")}]},{default:r(()=>[a(D,{modelValue:e.value.forward_config.forward_rule,"onUpdate:modelValue":t[14]||(t[14]=o=>e.value.forward_config.forward_rule=o),placeholder:l.$t("group.placeholder.forward_rule"),scrollbar:!1,onChange:A},{default:r(()=>[a(c,{value:"1"},{default:r(()=>[d("\u5168\u90E8\u8F6C\u53D1")]),_:1}),a(c,{value:"2"},{default:r(()=>[d("\u6309\u5173\u952E\u5B57")]),_:1}),a(c,{value:"3"},{default:r(()=>[d("\u5185\u5BB9\u957F\u5EA6")]),_:1}),a(c,{value:"4"},{default:r(()=>[d("\u5DF2\u7528\u989D\u5EA6")]),_:1})]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label","rules"])):f("",!0),e.value.is_enable_forward&&e.value.forward_config.forward_rule==="3"?(s(),i(u,{key:6,field:"forward_config.content_length",label:l.$t("group.label.content_length"),rules:[{required:!0,message:l.$t("group.error.content_length.required")}]},{default:r(()=>[a(q,{modelValue:e.value.forward_config.content_length,"onUpdate:modelValue":t[15]||(t[15]=o=>e.value.forward_config.content_length=o),placeholder:l.$t("group.placeholder.content_length"),precision:0,min:1,max:9999999999999,"allow-clear":""},null,8,["modelValue","placeholder"])]),_:1},8,["label","rules"])):f("",!0),e.value.is_enable_forward&&e.value.forward_config.forward_rule==="4"?(s(),i(u,{key:7,field:"forward_config.used_quota",label:l.$t("group.label.used_quota"),rules:[{required:!0,message:l.$t("group.error.used_quota.required")}]},{default:r(()=>[a(q,{modelValue:e.value.forward_config.used_quota,"onUpdate:modelValue":t[16]||(t[16]=o=>e.value.forward_config.used_quota=o),placeholder:l.$t("group.placeholder.used_quota"),min:1e-6,max:9999999999999,parser:_(T)},{prefix:r(()=>[d(" $ ")]),_:1},8,["modelValue","placeholder","min","parser"])]),_:1},8,["label","rules"])):f("",!0),e.value.is_enable_forward&&e.value.forward_config.forward_rule==="4"?(s(),i(u,{key:8},{default:r(()=>[a(E,{type:"button",onChange:j},{default:r(()=>[a(n,{value:100},{default:r(()=>[d(" $100 ")]),_:1}),a(n,{value:500},{default:r(()=>[d(" $500 ")]),_:1}),a(n,{value:1e3},{default:r(()=>[d(" $1,000 ")]),_:1}),a(n,{value:5e3},{default:r(()=>[d(" $5,000 ")]),_:1}),a(n,{value:1e4},{default:r(()=>[d(" $10,000 ")]),_:1}),a(n,{value:5e4},{default:r(()=>[d(" $50,000 ")]),_:1}),a(n,{value:1e5},{default:r(()=>[d(" $100,000 ")]),_:1}),a(n,{value:1e6},{default:r(()=>[d(" $1,000,000 ")]),_:1})]),_:1})]),_:1})):f("",!0),e.value.is_enable_forward&&(e.value.forward_config.forward_rule==="1"||e.value.forward_config.forward_rule==="3"||e.value.forward_config.forward_rule==="4")?(s(),i(u,{key:9,field:"forward_config.target_model",label:l.$t("group.label.target_model"),rules:[{required:!0,message:l.$t("group.error.target_model.required")}]},{default:r(()=>[a(D,{modelValue:e.value.forward_config.target_model,"onUpdate:modelValue":t[17]||(t[17]=o=>e.value.forward_config.target_model=o),placeholder:l.$t("group.placeholder.target_model"),scrollbar:!1,"allow-search":""},{default:r(()=>[(s(!0),y(C,null,F(B.value,o=>(s(),i(c,{key:o.id,value:o.id,label:o.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label","rules"])):f("",!0),e.value.is_enable_forward&&e.value.forward_config.forward_rule==="2"?(s(),i(u,{key:10,field:"forward_config.match_rule",label:l.$t("group.label.match_rule"),rules:[{required:!0,message:l.$t("group.error.match_rule.required")}]},{default:r(()=>[a(I,{size:"large"},{default:r(()=>[a(R,{modelValue:e.value.forward_config.match_rule,"onUpdate:modelValue":t[18]||(t[18]=o=>e.value.forward_config.match_rule=o),value:"1","default-checked":!0},{default:r(()=>[d("\u667A\u80FD\u5339\u914D")]),_:1},8,["modelValue"]),a(R,{modelValue:e.value.forward_config.match_rule,"onUpdate:modelValue":t[19]||(t[19]=o=>e.value.forward_config.match_rule=o),value:"2"},{default:r(()=>[d("\u6B63\u5219\u5339\u914D")]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["label","rules"])):f("",!0),e.value.is_enable_forward&&e.value.forward_config.forward_rule==="2"&&e.value.forward_config.match_rule.includes("1")?(s(),i(u,{key:11,field:"forward_config.decision_model",label:l.$t("group.label.decision_model"),rules:[{required:!0,message:l.$t("group.error.decision_model.required")}]},{default:r(()=>[a(D,{modelValue:e.value.forward_config.decision_model,"onUpdate:modelValue":t[20]||(t[20]=o=>e.value.forward_config.decision_model=o),placeholder:l.$t("group.placeholder.decision_model"),scrollbar:!1,"allow-search":""},{default:r(()=>[(s(!0),y(C,null,F(B.value,o=>(s(),i(c,{key:o.id,value:o.id,label:o.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label","rules"])):f("",!0),(s(!0),y(C,null,F(e.value.forward_config.keywords,(o,g)=>se((s(),i(u,{key:g,field:`forward_config.keywords[${g}]`&&`forward_config.target_models[${g}]`,label:`${g+1}. `+l.$t("group.label.keywords"),rules:[{required:!0,message:l.$t("group.error.keywords_target_model.required")}]},{default:r(()=>[a(k,{modelValue:e.value.forward_config.keywords[g],"onUpdate:modelValue":v=>e.value.forward_config.keywords[g]=v,placeholder:l.$t("group.placeholder.keywords"),style:{width:"45%","margin-right":"5px"}},null,8,["modelValue","onUpdate:modelValue","placeholder"]),a(D,{modelValue:e.value.forward_config.target_models[g],"onUpdate:modelValue":v=>e.value.forward_config.target_models[g]=v,placeholder:l.$t("group.placeholder.target_model"),scrollbar:!1,style:{width:"40%"},"allow-search":""},{default:r(()=>[(s(!0),y(C,null,F(B.value,v=>(s(),i(c,{key:v.id,value:v.id,label:v.name},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"]),a(G,{type:"primary",shape:"circle",style:{margin:"0 10px 0 10px"},onClick:W},{default:r(()=>[a(x)]),_:1}),a(G,{type:"secondary",shape:"circle",onClick:v=>X(g)},{default:r(()=>[a(ee)]),_:2},1032,["onClick"])]),_:2},1032,["field","label","rules"])),[[ne,e.value.is_enable_forward&&e.value.forward_config.forward_rule==="2"]])),128)),a(u,{field:"expires_at",label:l.$t("group.label.expires_at")},{default:r(()=>[a(le,{modelValue:e.value.expires_at,"onUpdate:modelValue":t[21]||(t[21]=o=>e.value.expires_at=o),placeholder:l.$t("group.placeholder.expires_at"),"time-picker-props":{defaultValue:"23:59:59"},"disabled-date":_(He),"allow-clear":"",style:{width:"100%"},"show-time":"",shortcuts:[{label:"1",value:()=>_(w)(e.value.expires_at||new Date().setHours(23,59,59,999)).add(1,"day")},{label:"7",value:()=>_(w)(e.value.expires_at||new Date().setHours(23,59,59,999)).add(7,"day")},{label:"15",value:()=>_(w)(e.value.expires_at||new Date().setHours(23,59,59,999)).add(15,"day")},{label:"30",value:()=>_(w)(e.value.expires_at||new Date().setHours(23,59,59,999)).add(30,"day")},{label:"90",value:()=>_(w)(e.value.expires_at||new Date().setHours(23,59,59,999)).add(90,"day")},{label:"180",value:()=>_(w)(e.value.expires_at||new Date().setHours(23,59,59,999)).add(180,"day")},{label:"365",value:()=>_(w)(e.value.expires_at||new Date().setHours(23,59,59,999)).add(365,"day")}]},null,8,["modelValue","placeholder","disabled-date","shortcuts"])]),_:1},8,["label"]),a(I,null,{default:r(()=>[N("div",Ke,[a(G,{type:"secondary",onClick:t[22]||(t[22]=o=>l.$router.push({name:"GroupList"}))},{default:r(()=>[d(h(l.$t("button.cancel")),1)]),_:1}),a(G,{type:"primary",onClick:J},{default:r(()=>[d(h(l.$t("button.submit")),1)]),_:1})])]),_:1})]),_:1},8,["model"])])]),_:1})]),_:1},8,["loading"])])}}});const hl=te(Je,[["__scopeId","data-v-7fccc59b"]]);export{hl as default};
