import{G as te,_ as de}from"./index.7d0ebe14.js";/* empty css               *//* empty css              *//* empty css               *//* empty css              *//* empty css               *//* empty css               *//* empty css               *//* empty css               *//* empty css                *//* empty css                *//* empty css              *//* empty css              *//* empty css               *//* empty css                */import{d as se,e as g,B as n,C as $,aH as l,aG as o,aL as t,aM as y,F as B,aD as _,aE as f,u as m,bT as v,aJ as C,aI as F,bu as ne,bv as ie,aK as _e,aF as fe,bJ as me,b1 as pe,b2 as ge,aS as ce,bP as ve,aT as we,bW as be,bO as ye,bQ as he,bV as $e,bi as Ve,bF as ke,bG as qe,b4 as Ue,a5 as De,aU as Ce,a4 as Fe,b5 as Be,bN as Ie,bR as Se,b9 as Ge,ba as Le,g as Me}from"./arco.ba78a5b2.js";import{u as Ae}from"./loading.0618e973.js";import{h as Ee,f as He}from"./vue.2736b3ca.js";import{q as Q}from"./common.df364eef.js";import{h as Re,a as Te}from"./group.94c1ba74.js";import{q as Ne,b as Qe}from"./model.4880ad17.js";import{f as Ke}from"./agent.052cc614.js";import"./chart.df189e8a.js";const Pe=I=>(Ge("data-v-b93ed5c4"),I=I(),Le(),I),ze={class:"container"},Je={class:"wrapper"},Oe=Pe(()=>B("div",{style:{"margin-left":"10px"}}," % ",-1)),je={style:{"margin-left":"10px"}},We={style:{"margin-left":"10px"}},Xe={class:"submit-btn"},Ye={name:"GroupUpdate"},Ze=se({...Ye,setup(I){const{loading:K,setLoading:p}=Ae(!1),{proxy:P}=Me(),z=Ee(),J=He(),S=g([]);(async()=>{p(!0);try{const{data:a}=await Ne();S.value=a.items}catch{}finally{p(!1)}})();const A=g([]);(async()=>{p(!0);try{const{data:a}=await Qe();A.value=a.items}catch{}finally{p(!1)}})();const E=g([]);(async()=>{p(!0);try{const{data:a}=await Ke();E.value=a.items}catch{}finally{p(!1)}})();const H=g(),e=g({name:"",discount:g(),models:[],is_default:!1,is_public:!0,weight:g(),expires_at:"",remark:"",status:1,is_enable_model_agent:!1,lb_strategy:"1",model_agents:[],is_limit_quota:!1,quota:g(),is_enable_forward:!1,forward_config:{forward_rule:"1",match_rule:["2"],target_model:"",decision_model:"",keywords:[],target_models:[],content_length:g(),used_quota:g()}}),O=async()=>{var u;if(!await((u=H.value)==null?void 0:u.validate())){p(!0);try{e.value.discount/=100,await Re(e.value).then(()=>{P.$message.success("\u66F4\u65B0\u6210\u529F"),J.push({name:"GroupList"})})}catch{}finally{p(!1)}}};(async(a={id:z.query.id})=>{var u,V,h,G,k;p(!0);try{const{data:d}=await Te(a);e.value.id=d.id,e.value.name=d.name,e.value.discount=Number((d.discount*100).toFixed(2)),e.value.models=d.models,e.value.is_default=d.is_default||!1,e.value.is_public=d.is_public||!1,e.value.weight=d.weight,e.value.expires_at=d.expires_at,e.value.remark=d.remark,e.value.status=d.status,e.value.is_enable_model_agent=d.is_enable_model_agent,e.value.lb_strategy=String(d.lb_strategy),e.value.model_agents=d.model_agents,e.value.is_limit_quota=d.is_limit_quota,e.value.quota=d.quota,e.value.is_enable_forward=d.is_enable_forward,e.value.forward_config=d.forward_config,d.forward_config&&(d.forward_config.forward_rule&&(e.value.forward_config.forward_rule=String(d.forward_config.forward_rule)),d.forward_config.match_rule&&(e.value.forward_config.match_rule=d.forward_config.match_rule.map(String)),e.value.forward_config.content_length=(u=d.forward_config)==null?void 0:u.content_length,e.value.forward_config.target_model=(V=d.forward_config)==null?void 0:V.target_model,e.value.forward_config.decision_model=(h=d.forward_config)==null?void 0:h.decision_model,e.value.forward_config.keywords=(G=d.forward_config)==null?void 0:G.keywords,e.value.forward_config.target_models=(k=d.forward_config)==null?void 0:k.target_models)}catch{}finally{p(!1)}})();const j=a=>{e.value.quota=a*5e5},W=a=>{e.value.forward_config.used_quota=a*5e5},R=()=>{!e.value.is_enable_forward&&e.value.forward_config.keywords&&(e.value.forward_config.keywords[0]===""||e.value.forward_config.target_models[0]==="")?(e.value.forward_config.keywords=[],e.value.forward_config.target_models=[]):e.value.forward_config.forward_rule==="2"&&(!e.value.forward_config.keywords||e.value.forward_config.keywords.length===0)?(e.value.forward_config.keywords=[""],e.value.forward_config.target_models=[""]):(e.value.forward_config.forward_rule==="1"||e.value.forward_config.forward_rule==="3"||e.value.forward_config.forward_rule==="4")&&e.value.forward_config.keywords&&(e.value.forward_config.keywords[0]===""||e.value.forward_config.target_models[0]==="")&&(e.value.forward_config.keywords=[],e.value.forward_config.target_models=[])},X=()=>{e.value.forward_config.keywords.push(""),e.value.forward_config.target_models.push("")},Y=a=>{e.value.forward_config.keywords.length>1&&(e.value.forward_config.keywords.splice(a,1),e.value.forward_config.target_models.splice(a,1))};return(a,u)=>{const V=te,h=_e,G=fe,k=me,d=pe,s=ge,q=ce,Z=ve,U=we,x=be,ee=ye,i=he,T=$e,M=Ve,w=ke,D=qe,N=Ue,le=De,L=Ce,ae=Fe,oe=Be,re=Ie,ue=Se;return n(),$("div",ze,[l(G,{class:"container-breadcrumb"},{default:o(()=>[l(h,null,{default:o(()=>[l(V)]),_:1}),l(h,null,{default:o(()=>[t(y(a.$t("menu.group")),1)]),_:1}),l(h,null,{default:o(()=>[t(y(a.$t("menu.group.update")),1)]),_:1})]),_:1}),l(ue,{loading:m(K),style:{width:"100%"}},{default:o(()=>[l(re,{class:"general-card","body-style":{padding:"0 20px 20px 20px"},bordered:!1},{default:o(()=>[B("div",Je,[l(oe,{ref_key:"formRef",ref:H,model:e.value,class:"form","label-col-props":{span:5},"wrapper-col-props":{span:18}},{default:o(()=>[l(k,{orientation:"left"},{default:o(()=>[t(y(a.$t("common.title.baseInfo")),1)]),_:1}),l(s,{field:"name",label:a.$t("group.label.name"),rules:[{required:!0,message:a.$t("group.error.name.required")}]},{default:o(()=>[l(d,{modelValue:e.value.name,"onUpdate:modelValue":u[0]||(u[0]=r=>e.value.name=r),placeholder:a.$t("group.placeholder.name"),"allow-clear":""},null,8,["modelValue","placeholder"])]),_:1},8,["label","rules"]),l(s,{field:"discount",label:a.$t("group.label.discount"),rules:[{required:!0,message:a.$t("group.error.discount.required")}]},{default:o(()=>[l(q,{modelValue:e.value.discount,"onUpdate:modelValue":u[1]||(u[1]=r=>e.value.discount=r),placeholder:a.$t("group.placeholder.discount"),min:.01,max:9999999999999,"allow-clear":""},null,8,["modelValue","placeholder","min"]),Oe]),_:1},8,["label","rules"]),l(s,{field:"models",label:a.$t("group.label.models"),rules:[{required:!0,message:a.$t("group.error.models.required")}]},{default:o(()=>[l(Z,{modelValue:e.value.models,"onUpdate:modelValue":u[2]||(u[2]=r=>e.value.models=r),placeholder:a.$t("group.placeholder.models"),"allow-search":!0,"allow-clear":!0,"tree-checkable":!0,data:A.value,"max-tag-count":3,scrollbar:!1,"tree-checked-strategy":"child"},null,8,["modelValue","placeholder","data"])]),_:1},8,["label","rules"]),l(s,{field:"is_default",label:a.$t("group.label.is_default"),rules:[{required:!0}]},{default:o(()=>[l(U,{modelValue:e.value.is_default,"onUpdate:modelValue":u[3]||(u[3]=r=>e.value.is_default=r)},null,8,["modelValue"])]),_:1},8,["label"]),l(s,{field:"is_public",label:a.$t("group.label.is_public"),rules:[{required:!0}]},{default:o(()=>[l(U,{modelValue:e.value.is_public,"onUpdate:modelValue":u[4]||(u[4]=r=>e.value.is_public=r)},null,8,["modelValue"])]),_:1},8,["label"]),e.value.is_default?f("",!0):(n(),_(s,{key:0,field:"weight",label:a.$t("group.label.weight")},{default:o(()=>[l(q,{modelValue:e.value.weight,"onUpdate:modelValue":u[5]||(u[5]=r=>e.value.weight=r),placeholder:a.$t("group.placeholder.weight"),precision:0,min:1,max:100,"allow-clear":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"])),l(s,{field:"expires_at",label:a.$t("group.label.expires_at")},{default:o(()=>[l(x,{modelValue:e.value.expires_at,"onUpdate:modelValue":u[6]||(u[6]=r=>e.value.expires_at=r),placeholder:a.$t("group.placeholder.expires_at"),"time-picker-props":{defaultValue:"23:59:59"},"disabled-date":r=>m(v)(r).isBefore(m(v)().subtract(1,"day")),"allow-clear":"",style:{width:"100%"},"show-time":"",shortcuts:[{label:"1",value:()=>m(v)(e.value.expires_at||new Date().setHours(23,59,59,999)).add(1,"day")},{label:"7",value:()=>m(v)(e.value.expires_at||new Date().setHours(23,59,59,999)).add(7,"day")},{label:"15",value:()=>m(v)(e.value.expires_at||new Date().setHours(23,59,59,999)).add(15,"day")},{label:"30",value:()=>m(v)(e.value.expires_at||new Date().setHours(23,59,59,999)).add(30,"day")},{label:"90",value:()=>m(v)(e.value.expires_at||new Date().setHours(23,59,59,999)).add(90,"day")},{label:"180",value:()=>m(v)(e.value.expires_at||new Date().setHours(23,59,59,999)).add(180,"day")},{label:"365",value:()=>m(v)(e.value.expires_at||new Date().setHours(23,59,59,999)).add(365,"day")}]},null,8,["modelValue","placeholder","disabled-date","shortcuts"])]),_:1},8,["label"]),l(s,{field:"remark",label:a.$t("group.label.remark"),rules:[{required:!1}]},{default:o(()=>[l(ee,{modelValue:e.value.remark,"onUpdate:modelValue":u[7]||(u[7]=r=>e.value.remark=r),placeholder:a.$t("group.placeholder.remark")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(k,{orientation:"left"},{default:o(()=>[t(y(a.$t("common.title.advanced")),1)]),_:1}),l(s,{field:"is_limit_quota",label:a.$t("group.label.is_limit_quota")},{default:o(()=>[l(U,{modelValue:e.value.is_limit_quota,"onUpdate:modelValue":u[8]||(u[8]=r=>e.value.is_limit_quota=r)},null,8,["modelValue"])]),_:1},8,["label"]),e.value.is_limit_quota?(n(),_(s,{key:1,field:"quota",label:a.$t("group.label.quota"),rules:[{required:!0,message:a.$t("group.error.quota.required")}]},{default:o(()=>[l(q,{modelValue:e.value.quota,"onUpdate:modelValue":u[9]||(u[9]=r=>e.value.quota=r),placeholder:a.$t("group.placeholder.quota"),precision:0,min:1,max:9999999999999,"allow-clear":""},null,8,["modelValue","placeholder"]),B("div",je," $"+y(e.value.quota?m(Q)(e.value.quota):"0.00"),1)]),_:1},8,["label","rules"])):f("",!0),e.value.is_limit_quota?(n(),_(s,{key:2},{default:o(()=>[l(T,{type:"button",onChange:j},{default:o(()=>[l(i,{value:1},{default:o(()=>[t(" $1 ")]),_:1}),l(i,{value:2},{default:o(()=>[t(" $2 ")]),_:1}),l(i,{value:5},{default:o(()=>[t(" $5 ")]),_:1}),l(i,{value:10},{default:o(()=>[t(" $10 ")]),_:1}),l(i,{value:20},{default:o(()=>[t(" $20 ")]),_:1}),l(i,{value:50},{default:o(()=>[t(" $50 ")]),_:1}),l(i,{value:100},{default:o(()=>[t(" $100 ")]),_:1}),l(i,{value:200},{default:o(()=>[t(" $200 ")]),_:1}),l(i,{value:500},{default:o(()=>[t(" $500 ")]),_:1}),l(i,{value:1e3},{default:o(()=>[t(" $1000 ")]),_:1})]),_:1},8,["onChange"])]),_:1})):f("",!0),l(s,{field:"is_enable_model_agent",label:a.$t("group.label.is_enable_model_agent")},{default:o(()=>[l(U,{modelValue:e.value.is_enable_model_agent,"onUpdate:modelValue":u[10]||(u[10]=r=>e.value.is_enable_model_agent=r)},null,8,["modelValue"])]),_:1},8,["label"]),e.value.is_enable_model_agent?(n(),_(s,{key:3,field:"lb_strategy",label:a.$t("model.label.lb_strategy"),rules:[{required:!0}]},{default:o(()=>[l(M,{size:"large"},{default:o(()=>[l(i,{modelValue:e.value.lb_strategy,"onUpdate:modelValue":u[11]||(u[11]=r=>e.value.lb_strategy=r),value:"1","default-checked":!0},{default:o(()=>[t(" \u8F6E\u8BE2 ")]),_:1},8,["modelValue"]),l(i,{modelValue:e.value.lb_strategy,"onUpdate:modelValue":u[12]||(u[12]=r=>e.value.lb_strategy=r),value:"2"},{default:o(()=>[t("\u6743\u91CD")]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["label"])):f("",!0),e.value.is_enable_model_agent?(n(),_(s,{key:4,field:"model_agents",label:a.$t("group.label.model_agents"),rules:[{required:!0,message:a.$t("group.error.model_agents.required")}]},{default:o(()=>[l(D,{modelValue:e.value.model_agents,"onUpdate:modelValue":u[13]||(u[13]=r=>e.value.model_agents=r),placeholder:a.$t("group.placeholder.model_agents"),"max-tag-count":3,scrollbar:!1,multiple:"","allow-search":"","allow-clear":""},{default:o(()=>[(n(!0),$(C,null,F(E.value,r=>(n(),_(w,{key:r.id,value:r.id,label:r.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label","rules"])):f("",!0),l(s,{field:"model_forward",label:a.$t("group.label.is_enable_forward")},{default:o(()=>[l(U,{modelValue:e.value.is_enable_forward,"onUpdate:modelValue":u[14]||(u[14]=r=>e.value.is_enable_forward=r),onChange:R},null,8,["modelValue"])]),_:1},8,["label"]),e.value.is_enable_forward?(n(),_(s,{key:5,field:"forward_config.forward_rule",label:a.$t("group.label.forward_rule"),rules:[{required:!0,message:a.$t("group.error.forward_rule.required")}]},{default:o(()=>[l(D,{modelValue:e.value.forward_config.forward_rule,"onUpdate:modelValue":u[15]||(u[15]=r=>e.value.forward_config.forward_rule=r),placeholder:a.$t("group.placeholder.forward_rule"),scrollbar:!1,onChange:R},{default:o(()=>[l(w,{value:"1"},{default:o(()=>[t("\u5168\u90E8\u8F6C\u53D1")]),_:1}),l(w,{value:"2"},{default:o(()=>[t("\u6309\u5173\u952E\u5B57")]),_:1}),l(w,{value:"3"},{default:o(()=>[t("\u5185\u5BB9\u957F\u5EA6")]),_:1}),l(w,{value:"4"},{default:o(()=>[t("\u5DF2\u7528\u989D\u5EA6")]),_:1})]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label","rules"])):f("",!0),e.value.is_enable_forward&&e.value.forward_config.forward_rule==="3"?(n(),_(s,{key:6,field:"forward_config.content_length",label:a.$t("group.label.content_length"),rules:[{required:!0,message:a.$t("group.error.content_length.required")}]},{default:o(()=>[l(q,{modelValue:e.value.forward_config.content_length,"onUpdate:modelValue":u[16]||(u[16]=r=>e.value.forward_config.content_length=r),placeholder:a.$t("group.placeholder.content_length"),precision:0,min:1,max:9999999999999,"allow-clear":""},null,8,["modelValue","placeholder"])]),_:1},8,["label","rules"])):f("",!0),e.value.is_enable_forward&&e.value.forward_config.forward_rule==="4"?(n(),_(s,{key:7,field:"forward_config.used_quota",label:a.$t("group.label.used_quota"),rules:[{required:!0,message:a.$t("group.error.used_quota.required")}]},{default:o(()=>[l(q,{modelValue:e.value.forward_config.used_quota,"onUpdate:modelValue":u[17]||(u[17]=r=>e.value.forward_config.used_quota=r),placeholder:a.$t("group.placeholder.used_quota"),precision:0,min:1,max:9999999999999,"allow-clear":""},null,8,["modelValue","placeholder"]),B("div",We," $"+y(e.value.forward_config.used_quota?m(Q)(e.value.forward_config.used_quota):"0.00"),1)]),_:1},8,["label","rules"])):f("",!0),e.value.is_enable_forward&&e.value.forward_config.forward_rule==="4"?(n(),_(s,{key:8},{default:o(()=>[l(T,{type:"button",onChange:W},{default:o(()=>[l(i,{value:1},{default:o(()=>[t(" $1 ")]),_:1}),l(i,{value:2},{default:o(()=>[t(" $2 ")]),_:1}),l(i,{value:5},{default:o(()=>[t(" $5 ")]),_:1}),l(i,{value:10},{default:o(()=>[t(" $10 ")]),_:1}),l(i,{value:20},{default:o(()=>[t(" $20 ")]),_:1}),l(i,{value:50},{default:o(()=>[t(" $50 ")]),_:1}),l(i,{value:100},{default:o(()=>[t(" $100 ")]),_:1}),l(i,{value:200},{default:o(()=>[t(" $200 ")]),_:1}),l(i,{value:500},{default:o(()=>[t(" $500 ")]),_:1}),l(i,{value:1e3},{default:o(()=>[t(" $1000 ")]),_:1})]),_:1},8,["onChange"])]),_:1})):f("",!0),e.value.is_enable_forward&&(e.value.forward_config.forward_rule==="1"||e.value.forward_config.forward_rule==="3"||e.value.forward_config.forward_rule==="4")?(n(),_(s,{key:9,field:"forward_config.target_model",label:a.$t("group.label.target_model"),rules:[{required:!0,message:a.$t("group.error.target_model.required")}]},{default:o(()=>[l(D,{modelValue:e.value.forward_config.target_model,"onUpdate:modelValue":u[18]||(u[18]=r=>e.value.forward_config.target_model=r),placeholder:a.$t("group.placeholder.target_model"),scrollbar:!1,"allow-search":""},{default:o(()=>[(n(!0),$(C,null,F(S.value,r=>(n(),_(w,{key:r.id,value:r.id,label:r.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label","rules"])):f("",!0),e.value.is_enable_forward&&e.value.forward_config.forward_rule==="2"?(n(),_(s,{key:10,field:"forward_config.match_rule",label:a.$t("group.label.match_rule"),rules:[{required:!0,message:a.$t("group.error.match_rule.required")}]},{default:o(()=>[l(M,{size:"large"},{default:o(()=>[l(N,{modelValue:e.value.forward_config.match_rule,"onUpdate:modelValue":u[19]||(u[19]=r=>e.value.forward_config.match_rule=r),value:"1","default-checked":!0},{default:o(()=>[t("\u667A\u80FD\u5339\u914D")]),_:1},8,["modelValue"]),l(N,{modelValue:e.value.forward_config.match_rule,"onUpdate:modelValue":u[20]||(u[20]=r=>e.value.forward_config.match_rule=r),value:"2"},{default:o(()=>[t("\u6B63\u5219\u5339\u914D")]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["label","rules"])):f("",!0),e.value.is_enable_forward&&e.value.forward_config.forward_rule==="2"&&e.value.forward_config.match_rule.includes("1")?(n(),_(s,{key:11,field:"forward_config.decision_model",label:a.$t("group.label.decision_model"),rules:[{required:!0,message:a.$t("group.error.decision_model.required")}]},{default:o(()=>[l(D,{modelValue:e.value.forward_config.decision_model,"onUpdate:modelValue":u[21]||(u[21]=r=>e.value.forward_config.decision_model=r),placeholder:a.$t("group.placeholder.decision_model"),scrollbar:!1,"allow-search":""},{default:o(()=>[(n(!0),$(C,null,F(S.value,r=>(n(),_(w,{key:r.id,value:r.id,label:r.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label","rules"])):f("",!0),(n(!0),$(C,null,F(e.value.forward_config.keywords,(r,c)=>ne((n(),_(s,{key:c,field:`forward_config.keywords[${c}]`&&`forward_config.target_models[${c}]`,label:`${c+1}. `+a.$t("group.label.keywords"),rules:[{required:!0,message:a.$t("group.error.keywords_target_model.required")}]},{default:o(()=>[l(d,{modelValue:e.value.forward_config.keywords[c],"onUpdate:modelValue":b=>e.value.forward_config.keywords[c]=b,placeholder:a.$t("group.placeholder.keywords"),style:{width:"45%","margin-right":"5px"}},null,8,["modelValue","onUpdate:modelValue","placeholder"]),l(D,{modelValue:e.value.forward_config.target_models[c],"onUpdate:modelValue":b=>e.value.forward_config.target_models[c]=b,placeholder:a.$t("group.placeholder.target_model"),scrollbar:!1,style:{width:"40%"},"allow-search":""},{default:o(()=>[(n(!0),$(C,null,F(S.value,b=>(n(),_(w,{key:b.id,value:b.id,label:b.name},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"]),l(L,{type:"primary",shape:"circle",style:{margin:"0 10px 0 10px"},onClick:X},{default:o(()=>[l(le)]),_:1}),l(L,{type:"secondary",shape:"circle",onClick:b=>Y(c)},{default:o(()=>[l(ae)]),_:2},1032,["onClick"])]),_:2},1032,["field","label","rules"])),[[ie,e.value.is_enable_forward&&e.value.forward_config.forward_rule==="2"]])),128)),l(M,null,{default:o(()=>[B("div",Xe,[l(L,{type:"secondary",onClick:u[22]||(u[22]=r=>a.$router.push({name:"GroupList"}))},{default:o(()=>[t(y(a.$t("button.cancel")),1)]),_:1}),l(L,{type:"primary",onClick:O},{default:o(()=>[t(y(a.$t("button.submit")),1)]),_:1})])]),_:1})]),_:1},8,["model"])])]),_:1})]),_:1},8,["loading"])])}}});const Ul=de(Ze,[["__scopeId","data-v-b93ed5c4"]]);export{Ul as default};
